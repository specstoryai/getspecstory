<!-- Generated by SpecStory, Markdown v2.1.0 -->

# 2026-01-23 17:24:15Z

<!-- Claude Code Session c94c863c-02e0-474e-b6d9-acb816f7fc55 (2026-01-23 17:24:15Z) -->

_**User (2026-01-23T17:24:15.996Z)**_

Look at the GH release workflow in ../intent

It's similar to the one here (see @.github/ and @specstory-cli/docs/CLI-RELEASE.md ) except more of it is automated, to include putting the changelog content into the release notes on GH for the release assets, and updating the homebrew-tap repo with the new version # and the SHA's for the 4 binaries.

We want to use the pattern from ../intent to update the workflow here to automate those last 2 manual steps as well. That's the only change we want to make to the release here, we don't want to change that it's a tag here that inititates the release (the ../intent repo is different in that regard).

Also take a look at ../intent/HOMEBREW-RELEASE.md That's the ideal format for the documentation, and we want to update @specstory-cli/docs/CLI-RELEASE.md to follow it. Steps for doing a release at the top of the doc, and reference content on how the release workflow works. Update the CLI-RELEASE to follow this format and to be up to date with the new release process and workflow.

Ask me any questions you have.

---

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:24:23.746Z)**_

<think><details><summary>Thought Process</summary>
The user wants me to:
1. Look at the GitHub release workflow in `../intent` repository
2. Compare it to the current workflow in this repo (`.github/` and `specstory-cli/docs/CLI-RELEASE.md`)
3. Automate the last 2 manual steps:
   - Putting changelog content into release notes on GitHub
   - Updating the homebrew-tap repo with new version # and SHA's for 4 binaries
4. Keep the tag-initiated release trigger (don't change that)
5. Update the CLI-RELEASE.md documentation to follow the format from `../intent/HOMEBREW-RELEASE.md`

I need to explore:
1. The `../intent` repo's release workflow and how it automates things
2. The current `.github/` workflows in this repo
3. The `../intent/HOMEBREW-RELEASE.md` documentation format

Let me launch some Explore agents to understand both codebases.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:24:24.474Z)**_

I'll explore both the `../intent` repository's release workflow and the current workflow here to understand the automation patterns. Let me launch some Explore agents to gather this information.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:24:27.734Z)**_

<tool-use data-tool-type="generic" data-tool-name="Task"><details>
<summary>Tool use: **Task**</summary>
Explore intent repo release workflow
```
Perfect! Now I have all the information I need. Let me create a comprehensive report of the findings.

## Detailed Findings: Intent Repository GitHub Release Workflow Automation

I've completed a thorough exploration of the Intent repository's GitHub release workflow automation. Here are my detailed findings:

### 1. GitHub Actions Workflow Files

**Location:** `/Users/sean/source/SpecStory/intent/.github/workflows/release.yml`

The main release workflow (`release.yml`) is a comprehensive multi-job workflow that orchestrates the entire release process. It contains 7 primary jobs:

#### Workflow Jobs Structure:

1. **`prepare` Job** - Decision gate that:
   - Detects component changes using `scripts/detect-changes.sh`
   - Determines if a release is needed
   - Identifies if a public release is required (via `[release]` in commit message)
   - Outputs: `release_required`, `public_release`, `node_bridge_changed`, `github_app_changed`, `node_bridge_sha`

2. **`build-and-test` Job** - Builds and validates:
   - Sets up Go 1.25.1 and Node.js 18
   - Runs `npm ci` for Node bridge
   - Executes `go test ./...`

3. **`version-and-tag` Job** - Creates release metadata:
   - Reads version from `internal/buildinfo/version.txt`
   - Creates git tag with format: `v{VERSION}+{BUILD_NUMBER}` (e.g., `v0.3.2+572`)
   - **Extracts changelog content** using AWK to parse `changelog.md`
   - Pushes tag to origin

4. **`goreleaser` Job** - Builds and publishes binaries:
   - Uses GoReleaser v2 to build for Linux/Darwin, x86_64/arm64
   - Embeds build metadata via ldflags (version, gitSHA, buildDate, nodeBridgeSHA)
   - Creates archives as .zip (Darwin) and .tar.gz (Linux)
   - Generates checksums.txt file

5. **`fly-deploy` Job** - Conditional GitHub App deployment:
   - Only runs if `github_app_changed == 'true'`
   - Deploys to Fly.io using flyctl

6. **`public-release` Job** - Public release to specstoryai/intent-releases:
   - Only runs if `public_release == 'true'`
   - **Puts changelog content into GitHub release notes**
   - **Sends Slack notification** to #intent-client with changelog

7. **`update-homebrew-tap` Job** - Updates Homebrew formula:
   - Only runs if `public_release == 'true'`
   - **Computes SHA256 hashes** for all binary artifacts
   - **Updates Homebrew formula** in specstoryai/homebrew-tap

---

### 2. Changelog Extraction and GitHub Release Notes

**Key Code in `release.yml` (lines 146-153):**

```yaml
# Extract changelog for this version from changelog.md
# Format: ## v0.3.1 2026-01-23 (includes header line)
CHANGELOG=$(awk -v version="v${VERSION}" 'BEGIN{p=0} /^## /{if ($0 ~ "^## " version){p=1; print; next} else if (p==1 && /^## /){exit}} p==1{print}' changelog.md)
{
  echo "changelog<<CHANGELOG_EOF"
  echo "$CHANGELOG"
  echo "CHANGELOG_EOF"
} >> "$GITHUB_OUTPUT"
```

**How it works:**
- Uses AWK to parse `changelog.md`
- Finds the section matching the version header (e.g., `## v0.3.2 2026-01-23`)
- Extracts all lines until the next version header
- Stores the multi-line content in a GitHub output variable

**GitHub Release Notes in `public-release` job (lines 279-300):**

```yaml
# Use changelog if available, fallback to version info
if [ -z "$CHANGELOG" ]; then
  NOTES="Release v${VERSION}+${BUILD_NUMBER}"
else
  NOTES="$CHANGELOG"
fi

# Create release on public repo
gh release create "$TAG" \
  --repo specstoryai/intent-releases \
  --title "Intent v${VERSION}+${BUILD_NUMBER}" \
  --notes "$NOTES" \
  dist/*
```

The extracted changelog is directly used as the GitHub release notes body.

---

### 3. Homebrew Tap Automation

#### SHA256 Hash Computation (lines 375-381)

```yaml
- name: Compute SHA256 hashes
  id: hashes
  run: |
    echo "darwin_arm64=$(shasum -a 256 dist/Intent_Darwin_arm64.zip | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
    echo "darwin_x86_64=$(shasum -a 256 dist/Intent_Darwin_x86_64.zip | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
    echo "linux_arm64=$(shasum -a 256 dist/Intent_Linux_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
    echo "linux_x86_64=$(shasum -a 256 dist/Intent_Linux_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
```

Each binary's SHA256 is computed after download and stored as job outputs.

#### Homebrew Formula Update

**Script:** `/Users/sean/source/SpecStory/intent/scripts/update-homebrew-formula.sh`

This script (67 lines) intelligently updates the Homebrew formula:

```bash
#!/usr/bin/env bash
# Updates the Homebrew formula with new version and SHA256 hashes.
# Usage: update-homebrew-formula.sh <formula_path> <version> <build_number> \
#        <sha_darwin_arm64> <sha_darwin_x86_64> <sha_linux_arm64> <sha_linux_x86_64>
```

**Key Features:**

1. **Version Update (lines 37-38):**
   ```bash
   sed "s/^  version \".*\"/  version \"${VERSION}\"/" "$FORMULA" > "${FORMULA}.tmp"
   ```

2. **Release Tag Update (lines 40-41):**
   ```bash
   sed "s/^  release_tag = \".*\"/  release_tag = \"${RELEASE_TAG}\"/" "$FORMULA" > "${FORMULA}.tmp"
   ```
   Tag format: `v{VERSION}%2B{BUILD_NUMBER}` (URL-encoded `+`)

3. **Context-Aware SHA256 Updates (lines 45-64):**
   ```bash
   awk -v darwin_arm64="$SHA_DARWIN_ARM64" \
       -v darwin_x86="$SHA_DARWIN_X86_64" \
       -v linux_arm64="$SHA_LINUX_ARM64" \
       -v linux_x86="$SHA_LINUX_X86_64" '
   {
     # Track what architecture we just saw in a URL line
     if (/Darwin_arm64/) { arch = "darwin_arm64" }
     else if (/Darwin_x86_64/) { arch = "darwin_x86" }
     else if (/Linux_arm64/) { arch = "linux_arm64" }
     else if (/Linux_x86_64/) { arch = "linux_x86" }
   
     # Replace sha256 based on the most recent URL context
     if (/sha256 "[a-f0-9]{64}"/) {
       if (arch == "darwin_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_arm64 "\"") }
       # ... similar for other architectures
     }
     print
   }'
   ```

   This approach is smart: it looks at each binary URL's architecture and updates the SHA256 hash that follows it.

4. **Validation (lines 18-29):**
   - Validates that all 4 SHA256 hashes match the 64-character hex format
   - Validates the formula file exists before modifying

**Workflow Integration (lines 391-408):**

```yaml
- name: Update formula
  run: |
    ./scripts/update-homebrew-formula.sh \
      homebrew-tap/Formula/intent.rb \
      "${{ needs.version-and-tag.outputs.version }}" \
      "${{ needs.version-and-tag.outputs.build_number }}" \
      "${{ steps.hashes.outputs.darwin_arm64 }}" \
      "${{ steps.hashes.outputs.darwin_x86_64 }}" \
      "${{ steps.hashes.outputs.linux_arm64 }}" \
      "${{ steps.hashes.outputs.linux_x86_64 }}"

- name: Commit and push
  run: |
    cd homebrew-tap
    git config user.name "intent-bot"
    git config user.email "actions@github.com"
    git add Formula/intent.rb
    git commit -m "Release intent v${{ needs.version-and-tag.outputs.version }}+${{ needs.version-and-tag.outputs.build_number }}"
    git push
```

---

### 4. HOMEBREW-RELEASE.md Documentation (Full Content)

**Location:** `/Users/sean/source/SpecStory/intent/HOMEBREW-RELEASE.md`

This comprehensive 165-line document covers:

#### Release Steps (Manual Process):
1. **Update version** in `internal/buildinfo/version.txt` following Semantic Versioning 2.0.0
2. **Update changelog** in `changelog.md` with sections for Announcements, Improvements, Bug Fixes
3. **Commit with `[release]` marker** - this triggers public release
4. **Verify the release** through GitHub Actions and test `brew install intent`

#### Three Repository Structure:
- `specstoryai/intent` (private) - source code and CI/CD
- `specstoryai/intent-releases` (public) - release artifacts for Homebrew
- `specstoryai/homebrew-tap` - Homebrew formula

#### Automated Workflow Details:
- **Release Tag Format:** `v{VERSION}+{BUILD_NUMBER}` (build number is GitHub Actions run number)
- **Build Metadata Embedding:**
  - `version` from `version.txt`
  - `gitSHA` - commit SHA
  - `buildDate` - UTC build timestamp
  - `nodeBridgeSHA` - hash of Node bridge bundle
  - Viewable via `intent version` command

#### Job Definitions Table:
| Job | Purpose |
|-----|---------|
| `prepare` | Detects component changes and determines if release is needed |
| `build-and-test` | Runs npm ci and go test |
| `version-and-tag` | Creates git tag and extracts changelog |
| `goreleaser` | Builds binaries for all platforms using GoReleaser |
| `fly-deploy` | Redeploys GitHub App when code changes |
| `public-release` | Publishes to intent-releases and notifies Slack |
| `update-homebrew-tap` | Computes SHA256 hashes and updates Homebrew formula |

#### Skip Conditions:
- Commit from `github-actions[bot]` (prevents infinite loops)
- Docs-only changes (`docs/` or `.specstory/` directories)
- Not on `main` branch

#### Required Secrets:
- `RELEASE_TOKEN` - PAT with write access to `intent-releases`
- `HOMEBREW_TAP_TOKEN` - PAT with write access to `homebrew-tap`
- `FLY_API_TOKEN` - Fly.io deploy token
- `SLACK_WEBHOOK_URL_INTENT_CLIENT` - Slack webhook for notifications

---

### 5. Supporting Scripts and Configuration

#### Change Detection Script
**Location:** `/Users/sean/source/SpecStory/intent/scripts/detect-changes.sh`

Detects:
- Node bridge changes (checks `pkg/node/` directory)
- GitHub App changes (checks `cmd/githubapp/`, `pkg/service/githubapp/`, `fly.toml`, `Dockerfile`)
- Docs-only changes (only files in `docs/` or `.specstory/`)
- Computes SHA256 of node bridge files for embedding

#### GoReleaser Configuration
**Location:** `/Users/sean/source/SpecStory/intent/.goreleaser.yml`

Builds for:
- Linux & Darwin (macOS)
- amd64 & arm64 architectures

**Embedded Metadata via ldflags:**
```yaml
ldflags:
  - -X github.com/specstoryai/intent/internal/buildinfo.version={{ .Env.VERSION }}
  - -X github.com/specstoryai/intent/internal/buildinfo.buildNumber={{ .Env.BUILD_NUMBER }}
  - -X github.com/specstoryai/intent/internal/buildinfo.gitSHA={{ .Env.GITHUB_SHA }}
  - -X github.com/specstoryai/intent/internal/buildinfo.buildDate={{ .Env.BUILD_DATE }}
  - -X github.com/specstoryai/intent/internal/buildinfo.nodeBridgeSHA={{ .Env.NODE_BRIDGE_SHA }}
```

**Output Archives:**
- macOS: ZIP archives
- Linux: TAR.GZ archives
- Naming: `Intent_Darwin_arm64.zip`, `Intent_Linux_x86_64.tar.gz`, etc.
- Also generates `checksums.txt`

#### Build Info Package
**Location:** `/Users/sean/source/SpecStory/intent/internal/buildinfo/buildinfo.go`

Exposes functions:
- `Version()` - semantic version
- `BuildNumber()` - CI run number or "dev"
- `VersionWithBuild()` - combined format `{version}+{buildNumber}`
- `GitSHA()` - commit SHA
- `BuildDate()` - UTC timestamp
- `NodeBridgeSHA()` - node bridge bundle hash

---

### 6. Changelog Format and Version Info

**Location:** `/Users/sean/source/SpecStory/intent/changelog.md`

**Format:**
```markdown
# Intent Changelog

## v0.3.2 2026-01-23

### üì¢ Announcements
- Summary of what's in this release

### ‚öôÔ∏è Improvements
- List of improvements

### üêõ Bug Fixes
- List of bug fixes
```

**Version File:** `/Users/sean/source/SpecStory/intent/internal/buildinfo/version.txt`
- Currently contains: `0.3.2`
- Simple semantic version number (no "v" prefix)

---

### 7. Release Tag Examples

The repository shows the tag format in action:
- `v0.3.2+572` - version 0.3.2, build 572
- `v0.3.1+571` - version 0.3.1, build 571
- `v0.3.0+570` - version 0.3.0, build 570
- Earlier: `v0.2.0+568`, `v0.2.0+549`, etc.

---

### Summary: Complete Automation Flow

```
Developer commits with [release] marker
        ‚Üì
Workflow triggered on main branch push
        ‚Üì
prepare: Detects if release needed (checks for [release] in commit)
        ‚Üì
build-and-test: Runs tests
        ‚Üì
version-and-tag: Reads version, extracts changelog from changelog.md, creates git tag
        ‚Üì
goreleaser: Builds binaries for 4 platforms, generates SHA256 hashes
        ‚Üì
public-release (if [release] set):
  - Downloads release artifacts
  - Uses extracted changelog as GitHub release notes
  - Posts to GitHub (specstoryai/intent-releases)
  - Sends Slack notification with changelog
        ‚Üì
update-homebrew-tap (if [release] set):
  - Downloads artifacts
  - Computes SHA256 for each binary
  - Calls update-homebrew-formula.sh to update Formula/intent.rb
  - Commits and pushes to specstoryai/homebrew-tap
```

All scripts are intelligent and reusable, with proper error handling and validation built in.
agentId: ae31b8f (for resuming to continue this agent's work if needed)
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:24:29.898Z)**_

<tool-use data-tool-type="generic" data-tool-name="Task"><details>
<summary>Tool use: **Task**</summary>
Explore current release workflow
```
Perfect! Now I have comprehensive information about the release workflow. Let me compile the findings into a detailed report.

## GitHub Release Workflow - Complete Analysis

I've explored the repository's GitHub release workflow and related configuration files. Here are my detailed findings:

### 1. Workflow Files in `.github/workflows/`

**Location:** `/Users/sean/source/SpecStory/getspecstory/.github/workflows/`

**Files found:**
- `release.yml` - The primary release automation workflow

---

### 2. Release Workflow (`release.yml`) - Detailed Breakdown

**File path:** `/Users/sean/source/SpecStory/getspecstory/.github/workflows/release.yml`

**Trigger:** 
- Activated on push to tags matching pattern `specstory-cli/v*`
- Example: `specstory-cli/v1.0.0`

**Jobs & Steps:**

1. **Setup** (ubuntu-latest, production environment)
   - Checkout code with full git history (fetch-depth: 0)
   - Setup Go 1.21

2. **Version Extraction**
   - Extracts version from git tag (e.g., `v1.0.0` from `specstory-cli/v1.0.0`)
   - Stores in `$GITHUB_OUTPUT` for use in later steps

3. **GoReleaser Build** (Action: `goreleaser/goreleaser-action@v6`)
   - Version: `~> v2`
   - Command: `release --clean --skip=validate`
   - Builds binaries for multiple platforms
   - Environment variables passed:
     - `GITHUB_TOKEN` - for GitHub API access
     - `POSTHOG_API_KEY` - analytics tracking
     - `GORELEASER_CURRENT_TAG` - version info

4. **Release Details Collection**
   - Extracts changelog from `specstory-cli/changelog.md`
   - Parses changelog format: `## v0.13.0 2025-10-26`
   - Outputs version and changelog as GitHub output
   - Marked as `continue-on-error: true`

5. **Slack Notification** (#clients channel)
   - Sends release notification to Slack webhook
   - Includes version and changelog
   - Uses custom JSON payload with SpecStory branding (color: #e35a2c)
   - Requires secret: `SLACK_WEBHOOK_URL_CLIENTS`

**Permissions:** `contents: write` (for creating releases)

---

### 3. GoReleaser Configuration

**File path:** `/Users/sean/source/SpecStory/getspecstory/.goreleaser.yml`

**Configuration details:**

```yaml
version: 2
project_name: SpecStoryCLI

builds:
  - env:
      - CGO_ENABLED=0
    goos: [linux, darwin]
    goarch: [amd64, arm64]
    binary: specstory
    main: ./main.go
    dir: ./specstory-cli
    ldflags:
      - -s -w
      - -X main.version={{.Version}}
      - -X github.com/specstoryai/getspecstory/specstory-cli/pkg/analytics.apiKey={{.Env.POSTHOG_API_KEY}}

archives:
  - id: targz
    formats: [tar.gz]
    name_template: SpecStoryCLI_{{title .Os}}_{{if eq .Arch "amd64"}}x86_64{{else}}{{.Arch}}{{end}}
    files: [none*]
  - id: zip
    formats: [zip]
    name_template: SpecStoryCLI_{{title .Os}}_{{if eq .Arch "amd64"}}x86_64{{else}}{{.Arch}}{{end}}
    files: [none*]
```

**Build targets:**
- Linux x86_64, Linux ARM64
- macOS (Darwin) x86_64, macOS ARM64 (Apple Silicon)
- Produces both `.tar.gz` and `.zip` archives

**Binary versioning:**
- Version injected via ldflags during build
- PostHog API key injected for analytics

---

### 4. Changelog Management

**File path:** `/Users/sean/source/SpecStory/getspecstory/specstory-cli/changelog.md`

**Current version:** v1.0.0 (2026-01-16)

**Format:**
```
## v1.0.0 2026-01-16

### üì¢ Announcements
- Release notes

### ‚öôÔ∏è Improvements
- Feature notes

### üêõ Bug Fixes
- Fix notes
```

**Latest entries:**
- v1.0.0: Public release, graduation from beta
- v0.18.0: Open source announcement (Apache 2.0)
- v0.17.0: Major markdown generation refactor
- v0.16.0: Google Gemini CLI support
- Extends back to v0.10.1

---

### 5. Homebrew Integration

**Documentation:** `/Users/sean/source/SpecStory/getspecstory/specstory-cli/docs/HOMEBREW-SETUP.md` and `/Users/sean/source/SpecStory/getspecstory/specstory-cli/docs/CLI-RELEASE.md`

**Current setup (as of Jan 16, 2026):**
- **Tap repo:** `specstoryai/homebrew-tap` (public)
- **Source repo:** `specstoryai/getspecstory` (public)
- **Tap usage:** `brew tap specstoryai/tap` then `brew install specstory`

**Manual release process (partially automated):**
1. Tag release in source repo: `git tag -a specstory-cli/v1.0.0 -m "Release v1.0.0"`
2. GitHub Action builds and pushes to releases
3. **Manual step:** Calculate SHA256 hashes for all 4 binaries using `shasum -a 256`
4. **Manual step:** Update Homebrew formula in tap repo with new version and SHA256 hashes
5. **Manual step:** Update product documentation in Mintlify dashboard

**Current installation method shown in README.md:**
```bash
brew tap specstoryai/tap
brew install specstory
```

---

### 6. Version Handling

**File path:** `/Users/sean/source/SpecStory/getspecstory/specstory-cli/main.go` (lines 29-30)

```go
// The current version of the CLI
var version = "dev" // Replaced with actual version in the production build process
```

- Development builds show "dev"
- Production builds inject actual version via ldflags: `-X main.version={{.Version}}`
- Version is accessible via `specstory version` command

---

### 7. Current Automation State Summary

**Fully Automated:**
- [x] Code building for all platforms (Linux/macOS, x86_64/ARM64)
- [x] Release creation on GitHub
- [x] Artifact upload (tar.gz + zip for each platform)
- [x] Changelog extraction from markdown file
- [x] Slack notification to #clients channel
- [x] Analytics API key injection (PostHog)

**Partially Automated / Manual:**
- [ ] SHA256 hash calculation (manual but documented)
- [ ] Homebrew formula updates (manual GitHub UI edit)
- [ ] Product documentation updates (manual Mintlify dashboard)
- [ ] Version update verification (manual)

**Key Secrets Required:**
- `GITHUB_TOKEN` - GitHub API access
- `POSTHOG_API_KEY` - Analytics key injection
- `SLACK_WEBHOOK_URL_CLIENTS` - Slack notifications

---

### 8. Release Documentation

**Release procedure document:** `/Users/sean/source/SpecStory/getspecstory/specstory-cli/docs/CLI-RELEASE.md`

This file contains comprehensive step-by-step instructions for:
- Preparing releases
- Creating tags
- Monitoring GitHub Actions
- Computing SHA256 hashes
- Updating Homebrew formula
- Verifying Homebrew installation
- Updating product documentation

**Note:** Documentation dated Jan 16, 2026, mentions "Much of this will be automated in the future."

---

### 9. Installation Methods Supported

From README.md (Line 56):
- **Homebrew:** `brew tap specstoryai/tap` ‚Üí `brew install specstory`
- **Direct release page:** https://github.com/specstoryai/getspecstory/releases

Future planned methods mentioned in docs:
- Curl installer script (documented but not yet implemented in main workflow)

---

### Key Findings Summary

The release workflow is **well-structured with 70% automation**, using GoReleaser for multi-platform builds and GitHub Actions for orchestration. The main automation gaps are Homebrew formula updates and SHA256 hash calculations, which are documented but require manual execution. The system is production-ready with proper environment separation, security via secrets management, and multi-channel notifications (Slack, GitHub releases, and analytics tracking).
agentId: a968dba (for resuming to continue this agent's work if needed)
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:28:41.829Z)**_

<think><details><summary>Thought Process</summary>
The exploration agents have provided detailed information about both repositories. Let me summarize what I've learned:

## Current State (getspecstory repo):
1. Tag-based release trigger: `specstory-cli/v*` pattern
2. GoReleaser builds 4 binaries (Darwin/Linux, x86_64/arm64) as both .tar.gz and .zip
3. Changelog extraction from `specstory-cli/changelog.md` already exists (but may need to verify it's used for release notes)
4. Slack notification already works
5. **Manual steps:**
   - Computing SHA256 hashes manually with curl
   - Updating homebrew-tap repo manually via GitHub UI
   - Updating Mintlify docs manually

## Intent repo automation patterns:
1. Push-based trigger with `[release]` marker in commit message
2. Changelog extraction via AWK that finds version header and extracts content
3. SHA256 hash computation step: `shasum -a 256 dist/Intent_Darwin_arm64.zip | cut -d' ' -f1`
4. `scripts/update-homebrew-formula.sh` - smart script that:
   - Updates version number
   - Updates release tag
   - Updates SHA256 hashes contextually (looks at URL to know which hash to update)
5. `update-homebrew-tap` job that:
   - Checks out homebrew-tap repo
   - Downloads artifacts
   - Computes SHA256 hashes
   - Runs the update script
   - Commits and pushes changes
6. Required secrets: `HOMEBREW_TAP_TOKEN` for pushing to homebrew-tap

## Documentation format (HOMEBREW-RELEASE.md):
- Release steps at top (simple numbered list)
- Reference content below explaining how the workflow works
- Job definitions table
- Skip conditions
- Required secrets
- Build metadata information

## What needs to be done for getspecstory:


I need to add a new `update-homebrew-tap` job to the release workflow that downloads artifacts, computes SHA256 hashes for the .tar.gz binaries, checks out the homebrew-tap repo, and pushes formula updates. I should also create a `scripts/update-homebrew-formula.sh` script that handles version and hash updates contextually, similar to Intent's approach. First, I need to verify whether GoReleaser is already populating the GitHub release notes with changelog content or if that needs to be configured.

I'll need to set up a `HOMEBREW_TAP_TOKEN` secret with write permissions to the homebrew-tap repository. The CLI-RELEASE.md documentation should mirror Intent's HOMEBREW-RELEASE.md structure, with quick release instructions upfront and detailed reference material below.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:28:44.135Z)**_

I now have a comprehensive understanding of both release workflows. Let me summarize the key findings:

**Current state (this repo):**
- Tag-triggered releases (`specstory-cli/v*`)
- GoReleaser builds 4 binaries (Darwin/Linux √ó x86_64/arm64)
- Changelog extraction exists but may not be used for release notes
- Slack notifications work
- **Manual:** SHA256 computation and homebrew-tap updates

**Intent repo automation patterns:**
- `update-homebrew-tap` job downloads artifacts, computes SHA256s, and pushes to homebrew-tap
- `scripts/update-homebrew-formula.sh` updates version and SHA256 hashes contextually
- Changelog extracted via AWK and used as GitHub release body
- Uses `HOMEBREW_TAP_TOKEN` secret for pushing to homebrew-tap

Let me launch a Plan agent to design the implementation approach.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:28:54.975Z)**_

<tool-use data-tool-type="generic" data-tool-name="Task"><details>
<summary>Tool use: **Task**</summary>
Plan release workflow automation
```
[Request interrupted by user for tool use]
```
</details></tool-use>

---

_**User (2026-01-23T17:32:34.627Z)**_

[Request interrupted by user for tool use]

_**User (2026-01-23T17:33:38.280Z)**_

What are you doing? The pattern for changelog is RIGHT THERE in the ../intent repo  you don't need to do any research on this, just follow the pattern

---

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:33:42.723Z)**_

<think><details><summary>Thought Process</summary>
The user is right - I already have all the information I need from the exploration. I should just write the plan directly based on the patterns found in the intent repo, not launch more agents to "design" things. Let me write the plan file now.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:33:43.710Z)**_

You're right, I have everything I need. Let me write the plan directly.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:33:58.882Z)**_

<tool-use data-tool-type="write" data-tool-name="Write"><details>
<summary>Tool use: **Write**</summary>

```md
# Plan: Automate SpecStory CLI Release Workflow

## Summary

Add automation to put changelog content into GitHub release notes and update the homebrew-tap repo with new version and SHA256 hashes. Follow patterns from `../intent` repo.

## Files to Modify

1. `.github/workflows/release.yml` - Add `update-homebrew-tap` job, ensure changelog goes to release notes
2. `specstory-cli/docs/CLI-RELEASE.md` - Rewrite to follow `../intent/HOMEBREW-RELEASE.md` format
3. **New:** `scripts/update-homebrew-formula.sh` - Script to update homebrew formula (copy pattern from intent)

## Implementation Steps

### 1. Create `scripts/update-homebrew-formula.sh`

Copy pattern from `/Users/sean/source/SpecStory/intent/scripts/update-homebrew-formula.sh`:
- Takes arguments: formula_path, version, sha_darwin_arm64, sha_darwin_x86_64, sha_linux_arm64, sha_linux_x86_64
- Uses sed to update version
- Uses awk to update SHA256 hashes contextually (looks at URL architecture to know which hash to update)
- Adapt for specstory naming (no build numbers, different binary names)

### 2. Update `.github/workflows/release.yml`

Add new job `update-homebrew-tap` that runs after goreleaser:

\```yaml
update-homebrew-tap:
  needs: [goreleaser]
  runs-on: ubuntu-latest
  steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Download release artifacts
      run: |
        VERSION="${GITHUB_REF#refs/tags/specstory-cli/}"
        gh release download "specstory-cli/${VERSION}" --pattern "SpecStoryCLI_*.tar.gz" --dir dist
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Compute SHA256 hashes
      id: hashes
      run: |
        echo "darwin_arm64=$(shasum -a 256 dist/SpecStoryCLI_Darwin_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
        echo "darwin_x86_64=$(shasum -a 256 dist/SpecStoryCLI_Darwin_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
        echo "linux_arm64=$(shasum -a 256 dist/SpecStoryCLI_Linux_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
        echo "linux_x86_64=$(shasum -a 256 dist/SpecStoryCLI_Linux_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"

    - name: Checkout homebrew-tap
      uses: actions/checkout@v4
      with:
        repository: specstoryai/homebrew-tap
        token: ${{ secrets.HOMEBREW_TAP_TOKEN }}
        path: homebrew-tap

    - name: Update formula
      run: |
        VERSION="${GITHUB_REF#refs/tags/specstory-cli/v}"
        ./scripts/update-homebrew-formula.sh \
          homebrew-tap/Formula/specstory.rb \
          "$VERSION" \
          "${{ steps.hashes.outputs.darwin_arm64 }}" \
          "${{ steps.hashes.outputs.darwin_x86_64 }}" \
          "${{ steps.hashes.outputs.linux_arm64 }}" \
          "${{ steps.hashes.outputs.linux_x86_64 }}"

    - name: Commit and push
      run: |
        cd homebrew-tap
        git config user.name "specstory-bot"
        git config user.email "actions@github.com"
        git add Formula/specstory.rb
        VERSION="${GITHUB_REF#refs/tags/specstory-cli/}"
        git commit -m "Release specstory ${VERSION}"
        git push
\```

Ensure changelog is used in release notes - check if GoReleaser already does this or if we need to add it to the release step.

### 3. Required Secret

Add `HOMEBREW_TAP_TOKEN` - a GitHub PAT with write access to `specstoryai/homebrew-tap` repository.

### 4. Update `specstory-cli/docs/CLI-RELEASE.md`

Rewrite to follow `../intent/HOMEBREW-RELEASE.md` format:
- Release steps at top (simple numbered list)
- Reference content below explaining how the workflow works
- Job definitions table
- Required secrets section

## Verification

1. Create a test tag to trigger the workflow
2. Verify GitHub release has changelog content in notes
3. Verify homebrew-tap repo was updated with correct version and SHA256 hashes
4. Run `brew update && brew upgrade specstory` to verify installation works

```
```
File created successfully at: /Users/sean/.claude/plans/abundant-coalescing-castle.md
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:34:03.897Z)**_

<think><details><summary>Thought Process</summary>
Now let me read the actual files I need to modify to make sure my plan is accurate, then I can finalize and exit plan mode. I should read:
1. The current release.yml to see exactly what needs to change
2. The intent's update-homebrew-formula.sh to copy the pattern
3. The intent's HOMEBREW-RELEASE.md for the doc format
4. The current homebrew formula to understand its structure
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:34:04.369Z)**_

Let me read the key files to verify my plan details are correct.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:34:04.817Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `./.github/workflows/release.yml`
```
     1‚Üíname: Release CLI
     2‚Üí
     3‚Üíon:
     4‚Üí  push:
     5‚Üí    tags:
     6‚Üí      - 'specstory-cli/v*'
     7‚Üí
     8‚Üípermissions:
     9‚Üí  contents: write
    10‚Üí
    11‚Üíjobs:
    12‚Üí  goreleaser:
    13‚Üí    runs-on: ubuntu-latest
    14‚Üí    environment: production
    15‚Üí    steps:
    16‚Üí      - uses: actions/checkout@v4
    17‚Üí        with:
    18‚Üí          fetch-depth: 0
    19‚Üí      - uses: actions/setup-go@v4
    20‚Üí        with:
    21‚Üí          go-version: '1.21'
    22‚Üí      - name: Extract version from tag
    23‚Üí        id: version
    24‚Üí        run: echo "version=${GITHUB_REF_NAME#specstory-cli/}" >> $GITHUB_OUTPUT
    25‚Üí
    26‚Üí      - uses: goreleaser/goreleaser-action@v6
    27‚Üí        with:
    28‚Üí          version: "~> v2"
    29‚Üí          args: release --clean --skip=validate
    30‚Üí        env:
    31‚Üí          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    32‚Üí          POSTHOG_API_KEY: ${{ secrets.POSTHOG_API_KEY }}
    33‚Üí          GORELEASER_CURRENT_TAG: ${{ steps.version.outputs.version }}
    34‚Üí
    35‚Üí      - name: Collect release details
    36‚Üí        id: release_details
    37‚Üí        continue-on-error: true
    38‚Üí        run: |
    39‚Üí            # Extract version from git tag (github.ref_name will be like "specstory-cli/v1.0.0")
    40‚Üí            VERSION="${{ github.ref_name }}"
    41‚Üí            VERSION="${VERSION#specstory-cli/}"  # Strip the subdirectory prefix
    42‚Üí            # Extract changelog for this version from specstory-cli/changelog.md
    43‚Üí            # The changelog format is: ## v0.13.0 2025-10-26
    44‚Üí            CHANGELOG=$(awk -v version="$VERSION" 'BEGIN{p=0} /^## /{if ($0 ~ "^## " version){p=1; next} else if (p==1 && /^## /){exit}} p==1{print}' specstory-cli/changelog.md)
    45‚Üí            {
    46‚Üí              echo "version=$VERSION"
    47‚Üí              echo "changelog<<CHANGELOG_EOF"
    48‚Üí              echo "$CHANGELOG"
    49‚Üí              echo "CHANGELOG_EOF"
    50‚Üí            } >> "$GITHUB_OUTPUT"
    51‚Üí
    52‚Üí      - name: Notify Slack (#clients)
    53‚Üí        env:
    54‚Üí            SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL_CLIENTS }}
    55‚Üí            VERSION: ${{ steps.release_details.outputs.version || 'unknown version' }}
    56‚Üí            CHANGELOG: ${{ steps.release_details.outputs.changelog || 'failed collecting release details' }}
    57‚Üí        run: |
    58‚Üí            {
    59‚Üí              printf "\n\nChangelog:\n%s\n" "$CHANGELOG"
    60‚Üí            } > message.txt
    61‚Üí
    62‚Üí            TITLE="*CLI $VERSION released*"
    63‚Üí            jq -n \
    64‚Üí              --rawfile text message.txt \
    65‚Üí              --arg title "$TITLE" \
    66‚Üí              --arg username "SpecStory Release Bot" \
    67‚Üí              --arg icon ":specstory:" \
    68‚Üí              '{
    69‚Üí                username: $username,
    70‚Üí                icon_emoji: $icon,
    71‚Üí                attachments: [
    72‚Üí                  {
    73‚Üí                    color: "#e35a2c",
    74‚Üí                    blocks: [
    75‚Üí                      {
    76‚Üí                        "type": "section",
    77‚Üí                        "text": { "type": "mrkdwn", "text": $title }
    78‚Üí                      },
    79‚Üí                      {
    80‚Üí                        "type": "section",
    81‚Üí                        "text": { "type": "mrkdwn", "text": $text }
    82‚Üí                      }
    83‚Üí                    ]
    84‚Üí                  }
    85‚Üí                ]
    86‚Üí              }' > payload.json
    87‚Üí            curl -X POST -H 'Content-type: application/json' --data @payload.json "$SLACK_WEBHOOK_URL"
    88‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:34:05.226Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `/Users/sean/source/SpecStory/intent/scripts/update-homebrew-formula.sh`
```
     1‚Üí#!/usr/bin/env bash
     2‚Üí# Updates the Homebrew formula with new version and SHA256 hashes.
     3‚Üí# Usage: update-homebrew-formula.sh <formula_path> <version> <build_number> \
     4‚Üí#        <sha_darwin_arm64> <sha_darwin_x86_64> <sha_linux_arm64> <sha_linux_x86_64>
     5‚Üí
     6‚Üíset -euo pipefail
     7‚Üí
     8‚ÜíFORMULA="$1"
     9‚ÜíVERSION="$2"
    10‚ÜíBUILD_NUMBER="$3"
    11‚ÜíSHA_DARWIN_ARM64="$4"
    12‚ÜíSHA_DARWIN_X86_64="$5"
    13‚ÜíSHA_LINUX_ARM64="$6"
    14‚ÜíSHA_LINUX_X86_64="$7"
    15‚Üí
    16‚ÜíRELEASE_TAG="v${VERSION}%2B${BUILD_NUMBER}"
    17‚Üí
    18‚Üí# Validate inputs
    19‚Üíif [[ ! -f "$FORMULA" ]]; then
    20‚Üí  echo "Error: Formula file not found: $FORMULA" >&2
    21‚Üí  exit 1
    22‚Üífi
    23‚Üí
    24‚Üífor sha in "$SHA_DARWIN_ARM64" "$SHA_DARWIN_X86_64" "$SHA_LINUX_ARM64" "$SHA_LINUX_X86_64"; do
    25‚Üí  if [[ ! "$sha" =~ ^[a-f0-9]{64}$ ]]; then
    26‚Üí    echo "Error: Invalid SHA256 hash: $sha" >&2
    27‚Üí    exit 1
    28‚Üí  fi
    29‚Üídone
    30‚Üí
    31‚Üíecho "Updating formula: $FORMULA"
    32‚Üíecho "  Version: $VERSION"
    33‚Üíecho "  Release tag: $RELEASE_TAG"
    34‚Üí
    35‚Üí# Update version and release_tag using sed
    36‚Üí# Use temp file for portability (macOS sed -i requires extension)
    37‚Üísed "s/^  version \".*\"/  version \"${VERSION}\"/" "$FORMULA" > "${FORMULA}.tmp"
    38‚Üímv "${FORMULA}.tmp" "$FORMULA"
    39‚Üí
    40‚Üísed "s/^  release_tag = \".*\"/  release_tag = \"${RELEASE_TAG}\"/" "$FORMULA" > "${FORMULA}.tmp"
    41‚Üímv "${FORMULA}.tmp" "$FORMULA"
    42‚Üí
    43‚Üí# Context-aware SHA256 update using awk
    44‚Üí# Matches each sha256 to the architecture in the URL above it
    45‚Üíawk -v darwin_arm64="$SHA_DARWIN_ARM64" \
    46‚Üí    -v darwin_x86="$SHA_DARWIN_X86_64" \
    47‚Üí    -v linux_arm64="$SHA_LINUX_ARM64" \
    48‚Üí    -v linux_x86="$SHA_LINUX_X86_64" '
    49‚Üí{
    50‚Üí  # Track what architecture we just saw in a URL line
    51‚Üí  if (/Darwin_arm64/) { arch = "darwin_arm64" }
    52‚Üí  else if (/Darwin_x86_64/) { arch = "darwin_x86" }
    53‚Üí  else if (/Linux_arm64/) { arch = "linux_arm64" }
    54‚Üí  else if (/Linux_x86_64/) { arch = "linux_x86" }
    55‚Üí
    56‚Üí  # Replace sha256 based on the most recent URL context
    57‚Üí  if (/sha256 "[a-f0-9]{64}"/) {
    58‚Üí    if (arch == "darwin_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_arm64 "\"") }
    59‚Üí    else if (arch == "darwin_x86") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_x86 "\"") }
    60‚Üí    else if (arch == "linux_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" linux_arm64 "\"") }
    61‚Üí    else if (arch == "linux_x86") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" linux_x86 "\"") }
    62‚Üí  }
    63‚Üí  print
    64‚Üí}' "$FORMULA" > "${FORMULA}.tmp" && mv "${FORMULA}.tmp" "$FORMULA"
    65‚Üí
    66‚Üíecho "Formula updated successfully"
    67‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:34:05.625Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `/Users/sean/source/SpecStory/intent/HOMEBREW-RELEASE.md`
```
     1‚Üí# Releasing Intent
     2‚Üí
     3‚ÜíThis document covers how to release Intent to Homebrew and how the release automation works.
     4‚Üí
     5‚Üí## How to Do a Release
     6‚Üí
     7‚ÜíReleasing Intent to Homebrew requires three steps:
     8‚Üí
     9‚Üí### 1. Update the Version
    10‚Üí
    11‚ÜíUpdate the version in `internal/buildinfo/version.txt`:
    12‚Üí
    13‚Üí```zsh
    14‚Üíecho "0.4.0" > internal/buildinfo/version.txt
    15‚Üí```
    16‚Üí
    17‚ÜíFollow [Semantic Versioning 2.0.0](https://semver.org/spec/v2.0.0.html) for version numbers.
    18‚Üí
    19‚Üí### 2. Update the Changelog
    20‚Üí
    21‚ÜíAdd an entry for the new version at the top of `changelog.md` (below the header):
    22‚Üí
    23‚Üí```markdown
    24‚Üí## v0.4.0 2026-01-23
    25‚Üí
    26‚Üí### üì¢ Announcements
    27‚Üí
    28‚Üí- Summary of what's in this release
    29‚Üí
    30‚Üí### ‚öôÔ∏è Improvements
    31‚Üí
    32‚Üí- List of improvements
    33‚Üí
    34‚Üí### üêõ Bug Fixes
    35‚Üí
    36‚Üí- List of bug fixes
    37‚Üí```
    38‚Üí
    39‚ÜíThe changelog entry will be:
    40‚Üí- Used as the GitHub release notes on `specstoryai/intent-releases`
    41‚Üí- Posted to the #intent-client Slack channel
    42‚Üí
    43‚Üí### 3. Commit with [release]
    44‚Üí
    45‚ÜíCommit your changes with `[release]` in the commit message:
    46‚Üí
    47‚Üí```zsh
    48‚Üígit add internal/buildinfo/version.txt changelog.md
    49‚Üígit commit -m "Release v0.4.0 [release]"
    50‚Üígit push origin main
    51‚Üí```
    52‚Üí
    53‚ÜíThe `[release]` marker triggers a public release. Without it, the build only creates an internal release on the private `specstoryai/intent` repository.
    54‚Üí
    55‚Üí### 4. Verify the Release
    56‚Üí
    57‚Üí1. Monitor progress in [GitHub Actions](https://github.com/specstoryai/intent/actions)
    58‚Üí2. Check the [public releases page](https://github.com/specstoryai/intent-releases/releases) for artifacts
    59‚Üí3. Verify Homebrew installation:
    60‚Üí
    61‚Üí```zsh
    62‚Üí# First time only: add the tap
    63‚Üíbrew tap specstoryai/tap
    64‚Üí
    65‚Üí# Install or upgrade
    66‚Üíbrew update
    67‚Üíbrew upgrade intent   # or: brew install intent
    68‚Üíintent version
    69‚Üí```
    70‚Üí
    71‚Üí## Repositories
    72‚Üí
    73‚Üí- **Source repo**: `specstoryai/intent` (private) - source code and CI/CD
    74‚Üí- **Release repo**: `specstoryai/intent-releases` (public) - release artifacts for Homebrew
    75‚Üí- **Homebrew tap**: `specstoryai/homebrew-tap` - contains the Homebrew formula
    76‚Üí
    77‚Üí---
    78‚Üí
    79‚Üí## How the Release Automation Works
    80‚Üí
    81‚ÜíThe `release` GitHub Actions workflow handles everything automatically when you push to `main`.
    82‚Üí
    83‚Üí### Workflow Overview
    84‚Üí
    85‚ÜíEvery push to `main` triggers the release workflow, which:
    86‚Üí
    87‚Üí1. Runs tests
    88‚Üí2. Builds binaries for macOS and Linux (amd64/arm64) with embedded build metadata
    89‚Üí3. Creates a tagged release on the private `specstoryai/intent` repository
    90‚Üí4. Conditionally redeploys the GitHub App on Fly.io when its code changes
    91‚Üí
    92‚ÜíWhen `[release]` is in the commit message, it additionally:
    93‚Üí
    94‚Üí5. Publishes artifacts to the public `specstoryai/intent-releases` repository
    95‚Üí6. Extracts changelog content for the release notes
    96‚Üí7. Sends a Slack notification to #intent-client
    97‚Üí8. Updates the Homebrew formula in `specstoryai/homebrew-tap`
    98‚Üí
    99‚Üí### Release Tag Format
   100‚Üí
   101‚ÜíTags follow the format `v{VERSION}+{BUILD_NUMBER}` (e.g., `v0.3.0+612`). The build number is the GitHub Actions run number, ensuring unique tags even for the same version.
   102‚Üí
   103‚Üí### Workflow Jobs
   104‚Üí
   105‚Üí| Job                   | Purpose                                                                      |
   106‚Üí|-----------------------|------------------------------------------------------------------------------|
   107‚Üí| `prepare`             | Detects component changes and determines if release/public release is needed |
   108‚Üí| `build-and-test`      | Runs `npm ci` for the Node bridge and `go test ./...`                        |
   109‚Üí| `version-and-tag`     | Creates the git tag and extracts changelog content                           |
   110‚Üí| `goreleaser`          | Builds binaries for all platforms using GoReleaser                           |
   111‚Üí| `fly-deploy`          | Redeploys the GitHub App when its code changes                               |
   112‚Üí| `public-release`      | Publishes to `intent-releases` and notifies Slack                            |
   113‚Üí| `update-homebrew-tap` | Computes SHA256 hashes and updates the Homebrew formula                      |
   114‚Üí
   115‚Üí### Build Metadata
   116‚Üí
   117‚ÜíBinaries are built with embedded metadata via Go ldflags:
   118‚Üí
   119‚Üí- `version` - Semantic version from `version.txt`
   120‚Üí- `gitSHA` - Commit SHA
   121‚Üí- `buildDate` - UTC build timestamp
   122‚Üí- `nodeBridgeSHA` - Hash of the Node bridge bundle
   123‚Üí
   124‚ÜíView this information with `intent version`.
   125‚Üí
   126‚Üí### Skip Conditions
   127‚Üí
   128‚ÜíThe workflow skips releases when:
   129‚Üí
   130‚Üí- The commit is from `github-actions[bot]` (prevents loops)
   131‚Üí- Only documentation files changed (`docs/` or `.specstory/`)
   132‚Üí- Not on the `main` branch
   133‚Üí
   134‚Üí### Required Secrets
   135‚Üí
   136‚ÜíThese secrets must be configured in the repository settings:
   137‚Üí
   138‚Üí| Secret                            | Purpose                                    |
   139‚Üí|-----------------------------------|--------------------------------------------|
   140‚Üí| `RELEASE_TOKEN`                   | PAT with write access to `intent-releases` |
   141‚Üí| `HOMEBREW_TAP_TOKEN`              | PAT with write access to `homebrew-tap`    |
   142‚Üí| `FLY_API_TOKEN`                   | Fly.io deploy token for the GitHub App     |
   143‚Üí| `SLACK_WEBHOOK_URL_INTENT_CLIENT` | Slack webhook for release notifications    |
   144‚Üí
   145‚Üí## Troubleshooting
   146‚Üí
   147‚Üí### Release workflow failed
   148‚Üí
   149‚ÜíCheck the [Actions tab](https://github.com/specstoryai/intent/actions) for error details. Common issues:
   150‚Üí
   151‚Üí- `RELEASE_TOKEN` or `HOMEBREW_TAP_TOKEN` secret expired or missing permissions
   152‚Üí- Fly.io deployment failed (check `FLY_API_TOKEN`)
   153‚Üí
   154‚Üí### SHA256 mismatch on brew install
   155‚Üí
   156‚ÜíThe Homebrew formula may be out of sync. Check that `update-homebrew-tap` job completed successfully.
   157‚Üí
   158‚Üí### Release not appearing on intent-releases
   159‚Üí
   160‚ÜíVerify that `[release]` was in your commit message. Without it, artifacts only go to the private repo.
   161‚Üí
   162‚Üí### Homebrew shows old version
   163‚Üí
   164‚ÜíRun `brew update` to refresh the tap, then `brew upgrade intent`.
   165‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:34:12.332Z)**_

<think><details><summary>Thought Process</summary>
Now I have all the details I need. Let me also check the current homebrew formula to understand its structure, and then update my plan file with the complete implementation details.

I notice:
1. The current release.yml extracts changelog but doesn't seem to use it for GitHub release notes - GoReleaser handles that. I need to check if GoReleaser is configured to use the changelog.
2. The intent script takes a build_number parameter which specstory doesn't use
3. The intent formula has a `release_tag` variable which specstory may not have

Let me check the goreleaser config and the current homebrew formula.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:34:12.905Z)**_

Let me also check the GoReleaser config and the current homebrew formula structure.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:34:13.598Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `./.goreleaser.yml`
```
     1‚Üíversion: 2
     2‚Üí
     3‚Üíproject_name: SpecStoryCLI
     4‚Üí
     5‚Üíbuilds:
     6‚Üí  - env:
     7‚Üí      - CGO_ENABLED=0
     8‚Üí    goos:
     9‚Üí      - linux
    10‚Üí      - darwin
    11‚Üí    goarch:
    12‚Üí      - amd64
    13‚Üí      - arm64
    14‚Üí    binary: specstory
    15‚Üí    main: ./main.go
    16‚Üí    dir: ./specstory-cli
    17‚Üí    ldflags:
    18‚Üí      - -s -w
    19‚Üí      - -X main.version={{.Version}}
    20‚Üí      - -X github.com/specstoryai/getspecstory/specstory-cli/pkg/analytics.apiKey={{.Env.POSTHOG_API_KEY}}
    21‚Üí
    22‚Üíarchives:
    23‚Üí  - id: targz
    24‚Üí    formats: [tar.gz]
    25‚Üí    name_template: >-
    26‚Üí      {{ .ProjectName }}_
    27‚Üí      {{- title .Os }}_
    28‚Üí      {{- if eq .Arch "amd64" }}x86_64
    29‚Üí      {{- else }}{{ .Arch }}{{ end }}
    30‚Üí    files:
    31‚Üí      - none*
    32‚Üí  - id: zip
    33‚Üí    formats: [zip]
    34‚Üí    name_template: >-
    35‚Üí      {{ .ProjectName }}_
    36‚Üí      {{- title .Os }}_
    37‚Üí      {{- if eq .Arch "amd64" }}x86_64
    38‚Üí      {{- else }}{{ .Arch }}{{ end }}
    39‚Üí    files:
    40‚Üí      - none*
    41‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:34:14.573Z)**_

<tool-use data-tool-type="read" data-tool-name="WebFetch"><details>
<summary>Tool use: **WebFetch**</summary>
```
The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). STOP what you are doing and wait for the user to tell you how to proceed.
```
</details></tool-use>

---

_**User (2026-01-23T17:34:25.352Z)**_

[Request interrupted by user for tool use]

_**User (2026-01-23T17:34:48.538Z)**_

You don't need to do that, you have a local copy at ../homebrew-tap

---

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:34:53.033Z)**_

<think><details><summary>Thought Process</summary>
Right, let me read from the local copy instead.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:34:53.434Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `/Users/sean/source/SpecStory/homebrew-tap/Formula/specstory.rb`
```
     1‚Üíclass Specstory < Formula
     2‚Üí  desc "A claude code wrapper that saves your conversation history to markdown"
     3‚Üí  homepage "https://github.com/specstoryai/getspecstory"
     4‚Üí  version "1.0.0"
     5‚Üí
     6‚Üí  on_macos do
     7‚Üí    if Hardware::CPU.arm?
     8‚Üí      url "https://github.com/specstoryai/getspecstory/releases/download/v#{version}/SpecStoryCLI_Darwin_arm64.tar.gz"
     9‚Üí      sha256 "b7ce6419336d1e84b666ec68764a5ccdf0d0a6a6c41c083bdc79bb13432a6d94"
    10‚Üí    else
    11‚Üí      url "https://github.com/specstoryai/getspecstory/releases/download/v#{version}/SpecStoryCLI_Darwin_x86_64.tar.gz"
    12‚Üí      sha256 "ba3ebc8da3c7845f11db1cf4459a4e7d559cf108f1b55c25c03af946d0e00d0f"
    13‚Üí    end
    14‚Üí  end
    15‚Üí
    16‚Üí  on_linux do
    17‚Üí    if Hardware::CPU.arm?
    18‚Üí      url "https://github.com/specstoryai/getspecstory/releases/download/v#{version}/SpecStoryCLI_Linux_arm64.tar.gz"
    19‚Üí      sha256 "938d44026542a1f92f6affe89bdd818c7e38dca66f7f13b4ff965230bfc721c9"
    20‚Üí    else
    21‚Üí      url "https://github.com/specstoryai/getspecstory/releases/download/v#{version}/SpecStoryCLI_Linux_x86_64.tar.gz"
    22‚Üí      sha256 "14e2b48dcf0c82e2410b59489d73ab23b6357e4b81fa63899218e86d2d893487"
    23‚Üí    end
    24‚Üí  end
    25‚Üí
    26‚Üí  def install
    27‚Üí    bin.install "specstory"
    28‚Üí  end
    29‚Üí
    30‚Üí  test do
    31‚Üí    assert_match "specstory", shell_output("#{bin}/specstory --version")
    32‚Üí  end
    33‚Üíend
    34‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:35:01.235Z)**_

<think><details><summary>Thought Process</summary>
Now I have all the information I need. The specstory formula is simpler than intent's - it uses `v#{version}` directly in URLs rather than a separate `release_tag` variable. The script needs to be adapted for this simpler format.

Key observations:
1. The formula uses `version "1.0.0"` (no v prefix in version)
2. URLs use `v#{version}` to construct paths like `/releases/download/v1.0.0/...`
3. No build number - simpler versioning
4. Same 4 platform structure as intent (Darwin/Linux √ó arm64/x86_64)

Now let me also check if GoReleaser is configured to use changelog for release notes. Looking at the goreleaser config, I don't see a `changelog` section, which means it's using the default behavior (auto-generated from git commits). We need to add changelog configuration or handle it differently.

Let me update my plan with the final details.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:35:01.754Z)**_

Now I have everything. Let me update the plan with the complete details.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:35:29.155Z)**_

<tool-use data-tool-type="write" data-tool-name="Write"><details>
<summary>Tool use: **Write**</summary>

```md
# Plan: Automate SpecStory CLI Release Workflow

## Summary

Add automation to:
1. Put changelog content into GitHub release notes
2. Update `specstoryai/homebrew-tap` with new version and SHA256 hashes

Keep the existing tag-based trigger (`specstory-cli/v*`).

## Files to Modify

1. `.github/workflows/release.yml` - Add `update-homebrew-tap` job, add release notes step
2. `specstory-cli/docs/CLI-RELEASE.md` - Rewrite following `../intent/HOMEBREW-RELEASE.md` format

## New Files

1. `scripts/update-homebrew-formula.sh` - Script to update homebrew formula

## Implementation Details

### 1. Create `scripts/update-homebrew-formula.sh`

Adapt from intent's script. Key differences:
- No build number (simpler versioning)
- Only update `version` line (no `release_tag` variable in specstory formula)
- Same SHA256 update logic (context-aware based on architecture in URL)

\```bash
#!/usr/bin/env bash
# Updates the Homebrew formula with new version and SHA256 hashes.
# Usage: update-homebrew-formula.sh <formula_path> <version> \
#        <sha_darwin_arm64> <sha_darwin_x86_64> <sha_linux_arm64> <sha_linux_x86_64>

set -euo pipefail

FORMULA="$1"
VERSION="$2"
SHA_DARWIN_ARM64="$3"
SHA_DARWIN_X86_64="$4"
SHA_LINUX_ARM64="$5"
SHA_LINUX_X86_64="$6"

# Validate inputs
if [[ ! -f "$FORMULA" ]]; then
  echo "Error: Formula file not found: $FORMULA" >&2
  exit 1
fi

for sha in "$SHA_DARWIN_ARM64" "$SHA_DARWIN_X86_64" "$SHA_LINUX_ARM64" "$SHA_LINUX_X86_64"; do
  if [[ ! "$sha" =~ ^[a-f0-9]{64}$ ]]; then
    echo "Error: Invalid SHA256 hash: $sha" >&2
    exit 1
  fi
done

echo "Updating formula: $FORMULA"
echo "  Version: $VERSION"

# Update version using sed (temp file for macOS compatibility)
sed "s/^  version \".*\"/  version \"${VERSION}\"/" "$FORMULA" > "${FORMULA}.tmp"
mv "${FORMULA}.tmp" "$FORMULA"

# Context-aware SHA256 update using awk
awk -v darwin_arm64="$SHA_DARWIN_ARM64" \
    -v darwin_x86="$SHA_DARWIN_X86_64" \
    -v linux_arm64="$SHA_LINUX_ARM64" \
    -v linux_x86="$SHA_LINUX_X86_64" '
{
  if (/Darwin_arm64/) { arch = "darwin_arm64" }
  else if (/Darwin_x86_64/) { arch = "darwin_x86" }
  else if (/Linux_arm64/) { arch = "linux_arm64" }
  else if (/Linux_x86_64/) { arch = "linux_x86" }

  if (/sha256 "[a-f0-9]{64}"/) {
    if (arch == "darwin_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_arm64 "\"") }
    else if (arch == "darwin_x86") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_x86 "\"") }
    else if (arch == "linux_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" linux_arm64 "\"") }
    else if (arch == "linux_x86") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" linux_x86 "\"") }
  }
  print
}' "$FORMULA" > "${FORMULA}.tmp" && mv "${FORMULA}.tmp" "$FORMULA"

echo "Formula updated successfully"
\```

### 2. Update `.github/workflows/release.yml`

Add after the Slack notification step:

\```yaml
  update-homebrew-tap:
    needs: [goreleaser]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Extract version from tag
        id: version
        run: |
          VERSION="${GITHUB_REF_NAME#specstory-cli/v}"
          echo "version=$VERSION" >> "$GITHUB_OUTPUT"

      - name: Download release artifacts
        run: |
          mkdir -p dist
          gh release download "$GITHUB_REF_NAME" --pattern "SpecStoryCLI_*.tar.gz" --dir dist
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Compute SHA256 hashes
        id: hashes
        run: |
          echo "darwin_arm64=$(shasum -a 256 dist/SpecStoryCLI_Darwin_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
          echo "darwin_x86_64=$(shasum -a 256 dist/SpecStoryCLI_Darwin_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
          echo "linux_arm64=$(shasum -a 256 dist/SpecStoryCLI_Linux_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
          echo "linux_x86_64=$(shasum -a 256 dist/SpecStoryCLI_Linux_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"

      - name: Checkout homebrew-tap
        uses: actions/checkout@v4
        with:
          repository: specstoryai/homebrew-tap
          token: ${{ secrets.HOMEBREW_TAP_TOKEN }}
          path: homebrew-tap

      - name: Update formula
        run: |
          ./scripts/update-homebrew-formula.sh \
            homebrew-tap/Formula/specstory.rb \
            "${{ steps.version.outputs.version }}" \
            "${{ steps.hashes.outputs.darwin_arm64 }}" \
            "${{ steps.hashes.outputs.darwin_x86_64 }}" \
            "${{ steps.hashes.outputs.linux_arm64 }}" \
            "${{ steps.hashes.outputs.linux_x86_64 }}"

      - name: Commit and push
        run: |
          cd homebrew-tap
          git config user.name "specstory-bot"
          git config user.email "actions@github.com"
          git add Formula/specstory.rb
          git commit -m "Release specstory v${{ steps.version.outputs.version }}"
          git push
\```

Add step to update GitHub release notes with changelog (after GoReleaser, before Slack):

\```yaml
      - name: Update release notes with changelog
        run: |
          VERSION="${GITHUB_REF_NAME#specstory-cli/}"
          CHANGELOG=$(awk -v version="$VERSION" 'BEGIN{p=0} /^## /{if ($0 ~ "^## " version){p=1; next} else if (p==1 && /^## /){exit}} p==1{print}' specstory-cli/changelog.md)
          if [ -n "$CHANGELOG" ]; then
            gh release edit "$GITHUB_REF_NAME" --notes "$CHANGELOG"
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
\```

### 3. Required Secret

Add `HOMEBREW_TAP_TOKEN` - GitHub PAT with write access to `specstoryai/homebrew-tap`.

### 4. Rewrite `specstory-cli/docs/CLI-RELEASE.md`

Follow the format from `../intent/HOMEBREW-RELEASE.md`:
- Release steps at top (numbered list)
- Reference content below explaining automation
- Workflow jobs table
- Required secrets table
- Troubleshooting section

## Verification

1. Create a test release tag
2. Verify GitHub release has changelog in notes
3. Verify homebrew-tap updated with correct version and SHA256s
4. Run `brew update && brew upgrade specstory` to verify

```
```
The file /Users/sean/.claude/plans/abundant-coalescing-castle.md has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
     1‚Üí# Plan: Automate SpecStory CLI Release Workflow
     2‚Üí
     3‚Üí## Summary
     4‚Üí
     5‚ÜíAdd automation to:
     6‚Üí1. Put changelog content into GitHub release notes
     7‚Üí2. Update `specstoryai/homebrew-tap` with new version and SHA256 hashes
     8‚Üí
     9‚ÜíKeep the existing tag-based trigger (`specstory-cli/v*`).
    10‚Üí
    11‚Üí## Files to Modify
    12‚Üí
    13‚Üí1. `.github/workflows/release.yml` - Add `update-homebrew-tap` job, add release notes step
    14‚Üí2. `specstory-cli/docs/CLI-RELEASE.md` - Rewrite following `../intent/HOMEBREW-RELEASE.md` format
    15‚Üí
    16‚Üí## New Files
    17‚Üí
    18‚Üí1. `scripts/update-homebrew-formula.sh` - Script to update homebrew formula
    19‚Üí
    20‚Üí## Implementation Details
    21‚Üí
    22‚Üí### 1. Create `scripts/update-homebrew-formula.sh`
    23‚Üí
    24‚ÜíAdapt from intent's script. Key differences:
    25‚Üí- No build number (simpler versioning)
    26‚Üí- Only update `version` line (no `release_tag` variable in specstory formula)
    27‚Üí- Same SHA256 update logic (context-aware based on architecture in URL)
    28‚Üí
    29‚Üí```bash
    30‚Üí#!/usr/bin/env bash
    31‚Üí# Updates the Homebrew formula with new version and SHA256 hashes.
    32‚Üí# Usage: update-homebrew-formula.sh <formula_path> <version> \
    33‚Üí#        <sha_darwin_arm64> <sha_darwin_x86_64> <sha_linux_arm64> <sha_linux_x86_64>
    34‚Üí
    35‚Üíset -euo pipefail
    36‚Üí
    37‚ÜíFORMULA="$1"
    38‚ÜíVERSION="$2"
    39‚ÜíSHA_DARWIN_ARM64="$3"
    40‚ÜíSHA_DARWIN_X86_64="$4"
    41‚ÜíSHA_LINUX_ARM64="$5"
    42‚ÜíSHA_LINUX_X86_64="$6"
    43‚Üí
    44‚Üí# Validate inputs
    45‚Üíif [[ ! -f "$FORMULA" ]]; then
    46‚Üí  echo "Error: Formula file not found: $FORMULA" >&2
    47‚Üí  exit 1
    48‚Üífi
    49‚Üí
    50‚Üífor sha in "$SHA_DARWIN_ARM64" "$SHA_DARWIN_X86_64" "$SHA_LINUX_ARM64" "$SHA_LINUX_X86_64"; do
    51‚Üí  if [[ ! "$sha" =~ ^[a-f0-9]{64}$ ]]; then
    52‚Üí    echo "Error: Invalid SHA256 hash: $sha" >&2
    53‚Üí    exit 1
    54‚Üí  fi
    55‚Üídone
    56‚Üí
    57‚Üíecho "Updating formula: $FORMULA"
    58‚Üíecho "  Version: $VERSION"
    59‚Üí
    60‚Üí# Update version using sed (temp file for macOS compatibility)
    61‚Üísed "s/^  version \".*\"/  version \"${VERSION}\"/" "$FORMULA" > "${FORMULA}.tmp"
    62‚Üímv "${FORMULA}.tmp" "$FORMULA"
    63‚Üí
    64‚Üí# Context-aware SHA256 update using awk
    65‚Üíawk -v darwin_arm64="$SHA_DARWIN_ARM64" \
    66‚Üí    -v darwin_x86="$SHA_DARWIN_X86_64" \
    67‚Üí    -v linux_arm64="$SHA_LINUX_ARM64" \
    68‚Üí    -v linux_x86="$SHA_LINUX_X86_64" '
    69‚Üí{
    70‚Üí  if (/Darwin_arm64/) { arch = "darwin_arm64" }
    71‚Üí  else if (/Darwin_x86_64/) { arch = "darwin_x86" }
    72‚Üí  else if (/Linux_arm64/) { arch = "linux_arm64" }
    73‚Üí  else if (/Linux_x86_64/) { arch = "linux_x86" }
    74‚Üí
    75‚Üí  if (/sha256 "[a-f0-9]{64}"/) {
    76‚Üí    if (arch == "darwin_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_arm64 "\"") }
    77‚Üí    else if (arch == "darwin_x86") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_x86 "\"") }
    78‚Üí    else if (arch == "linux_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" linux_arm64 "\"") }
    79‚Üí    else if (arch == "linux_x86") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" linux_x86 "\"") }
    80‚Üí  }
    81‚Üí  print
    82‚Üí}' "$FORMULA" > "${FORMULA}.tmp" && mv "${FORMULA}.tmp" "$FORMULA"
    83‚Üí
    84‚Üíecho "Formula updated successfully"
    85‚Üí```
    86‚Üí
    87‚Üí### 2. Update `.github/workflows/release.yml`
    88‚Üí
    89‚ÜíAdd after the Slack notification step:
    90‚Üí
    91‚Üí```yaml
    92‚Üí  update-homebrew-tap:
    93‚Üí    needs: [goreleaser]
    94‚Üí    runs-on: ubuntu-latest
    95‚Üí    steps:
    96‚Üí      - name: Checkout
    97‚Üí        uses: actions/checkout@v4
    98‚Üí
    99‚Üí      - name: Extract version from tag
   100‚Üí        id: version
   101‚Üí        run: |
   102‚Üí          VERSION="${GITHUB_REF_NAME#specstory-cli/v}"
   103‚Üí          echo "version=$VERSION" >> "$GITHUB_OUTPUT"
   104‚Üí
   105‚Üí      - name: Download release artifacts
   106‚Üí        run: |
   107‚Üí          mkdir -p dist
   108‚Üí          gh release download "$GITHUB_REF_NAME" --pattern "SpecStoryCLI_*.tar.gz" --dir dist
   109‚Üí        env:
   110‚Üí          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
   111‚Üí
   112‚Üí      - name: Compute SHA256 hashes
   113‚Üí        id: hashes
   114‚Üí        run: |
   115‚Üí          echo "darwin_arm64=$(shasum -a 256 dist/SpecStoryCLI_Darwin_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
   116‚Üí          echo "darwin_x86_64=$(shasum -a 256 dist/SpecStoryCLI_Darwin_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
   117‚Üí          echo "linux_arm64=$(shasum -a 256 dist/SpecStoryCLI_Linux_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
   118‚Üí          echo "linux_x86_64=$(shasum -a 256 dist/SpecStoryCLI_Linux_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
   119‚Üí
   120‚Üí      - name: Checkout homebrew-tap
   121‚Üí        uses: actions/checkout@v4
   122‚Üí        with:
   123‚Üí          repository: specstoryai/homebrew-tap
   124‚Üí          token: ${{ secrets.HOMEBREW_TAP_TOKEN }}
   125‚Üí          path: homebrew-tap
   126‚Üí
   127‚Üí      - name: Update formula
   128‚Üí        run: |
   129‚Üí          ./scripts/update-homebrew-formula.sh \
   130‚Üí            homebrew-tap/Formula/specstory.rb \
   131‚Üí            "${{ steps.version.outputs.version }}" \
   132‚Üí            "${{ steps.hashes.outputs.darwin_arm64 }}" \
   133‚Üí            "${{ steps.hashes.outputs.darwin_x86_64 }}" \
   134‚Üí            "${{ steps.hashes.outputs.linux_arm64 }}" \
   135‚Üí            "${{ steps.hashes.outputs.linux_x86_64 }}"
   136‚Üí
   137‚Üí      - name: Commit and push
   138‚Üí        run: |
   139‚Üí          cd homebrew-tap
   140‚Üí          git config user.name "specstory-bot"
   141‚Üí          git config user.email "actions@github.com"
   142‚Üí          git add Formula/specstory.rb
   143‚Üí          git commit -m "Release specstory v${{ steps.version.outputs.version }}"
   144‚Üí          git push
   145‚Üí```
   146‚Üí
   147‚ÜíAdd step to update GitHub release notes with changelog (after GoReleaser, before Slack):
   148‚Üí
   149‚Üí```yaml
   150‚Üí      - name: Update release notes with changelog
   151‚Üí        run: |
   152‚Üí          VERSION="${GITHUB_REF_NAME#specstory-cli/}"
   153‚Üí          CHANGELOG=$(awk -v version="$VERSION" 'BEGIN{p=0} /^## /{if ($0 ~ "^## " version){p=1; next} else if (p==1 && /^## /){exit}} p==1{print}' specstory-cli/changelog.md)
   154‚Üí          if [ -n "$CHANGELOG" ]; then
   155‚Üí            gh release edit "$GITHUB_REF_NAME" --notes "$CHANGELOG"
   156‚Üí          fi
   157‚Üí        env:
   158‚Üí          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
   159‚Üí```
   160‚Üí
   161‚Üí### 3. Required Secret
   162‚Üí
   163‚ÜíAdd `HOMEBREW_TAP_TOKEN` - GitHub PAT with write access to `specstoryai/homebrew-tap`.
   164‚Üí
   165‚Üí### 4. Rewrite `specstory-cli/docs/CLI-RELEASE.md`
   166‚Üí
   167‚ÜíFollow the format from `../intent/HOMEBREW-RELEASE.md`:
   168‚Üí- Release steps at top (numbered list)
   169‚Üí- Reference content below explaining automation
   170‚Üí- Workflow jobs table
   171‚Üí- Required secrets table
   172‚Üí- Troubleshooting section
   173‚Üí
   174‚Üí## Verification
   175‚Üí
   176‚Üí1. Create a test release tag
   177‚Üí2. Verify GitHub release has changelog in notes
   178‚Üí3. Verify homebrew-tap updated with correct version and SHA256s
   179‚Üí4. Run `brew update && brew upgrade specstory` to verify
   180‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:35:34.426Z)**_

<think><details><summary>Thought Process</summary>
The plan is complete. I have all the details needed:

1. Create `scripts/update-homebrew-formula.sh` - adapted from intent, simplified for no build numbers
2. Update `.github/workflows/release.yml` - add release notes update step and `update-homebrew-tap` job
3. Add `HOMEBREW_TAP_TOKEN` secret requirement
4. Rewrite `specstory-cli/docs/CLI-RELEASE.md` following intent's format

I should call ExitPlanMode now to get user approval.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:35:36.162Z)**_

The plan is complete. It covers:

1. **New script** `scripts/update-homebrew-formula.sh` - adapted from intent's pattern, simplified (no build numbers)
2. **Workflow changes** - add `update-homebrew-tap` job and release notes update step
3. **Required secret** - `HOMEBREW_TAP_TOKEN`
4. **Documentation rewrite** - `CLI-RELEASE.md` following intent's format

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:35:36.214Z)**_

<tool-use data-tool-type="generic" data-tool-name="ExitPlanMode"><details>
<summary>Tool use: **ExitPlanMode**</summary>
```
The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). STOP what you are doing and wait for the user to tell you how to proceed.
```
</details></tool-use>

---

_**User (2026-01-23T17:38:16.090Z)**_

[Request interrupted by user for tool use]

_**User (2026-01-23T17:38:16.557Z)**_

Implement the following plan:

# Plan: Automate SpecStory CLI Release Workflow

## Summary

Add automation to:
1. Put changelog content into GitHub release notes
2. Update `specstoryai/homebrew-tap` with new version and SHA256 hashes

Keep the existing tag-based trigger (`specstory-cli/v*`).

## Files to Modify

1. `.github/workflows/release.yml` - Add `update-homebrew-tap` job, add release notes step
2. `specstory-cli/docs/CLI-RELEASE.md` - Rewrite following `../intent/HOMEBREW-RELEASE.md` format

## New Files

1. `scripts/update-homebrew-formula.sh` - Script to update homebrew formula

## Implementation Details

### 1. Create `scripts/update-homebrew-formula.sh`

Adapt from intent's script. Key differences:
- No build number (simpler versioning)
- Only update `version` line (no `release_tag` variable in specstory formula)
- Same SHA256 update logic (context-aware based on architecture in URL)

```bash
#!/usr/bin/env bash
# Updates the Homebrew formula with new version and SHA256 hashes.
# Usage: update-homebrew-formula.sh <formula_path> <version> \
#        <sha_darwin_arm64> <sha_darwin_x86_64> <sha_linux_arm64> <sha_linux_x86_64>

set -euo pipefail

FORMULA="$1"
VERSION="$2"
SHA_DARWIN_ARM64="$3"
SHA_DARWIN_X86_64="$4"
SHA_LINUX_ARM64="$5"
SHA_LINUX_X86_64="$6"

# Validate inputs
if [[ ! -f "$FORMULA" ]]; then
  echo "Error: Formula file not found: $FORMULA" >&2
  exit 1
fi

for sha in "$SHA_DARWIN_ARM64" "$SHA_DARWIN_X86_64" "$SHA_LINUX_ARM64" "$SHA_LINUX_X86_64"; do
  if [[ ! "$sha" =~ ^[a-f0-9]{64}$ ]]; then
    echo "Error: Invalid SHA256 hash: $sha" >&2
    exit 1
  fi
done

echo "Updating formula: $FORMULA"
echo "  Version: $VERSION"

# Update version using sed (temp file for macOS compatibility)
sed "s/^  version \".*\"/  version \"${VERSION}\"/" "$FORMULA" > "${FORMULA}.tmp"
mv "${FORMULA}.tmp" "$FORMULA"

# Context-aware SHA256 update using awk
awk -v darwin_arm64="$SHA_DARWIN_ARM64" \
    -v darwin_x86="$SHA_DARWIN_X86_64" \
    -v linux_arm64="$SHA_LINUX_ARM64" \
    -v linux_x86="$SHA_LINUX_X86_64" '
{
  if (/Darwin_arm64/) { arch = "darwin_arm64" }
  else if (/Darwin_x86_64/) { arch = "darwin_x86" }
  else if (/Linux_arm64/) { arch = "linux_arm64" }
  else if (/Linux_x86_64/) { arch = "linux_x86" }

  if (/sha256 "[a-f0-9]{64}"/) {
    if (arch == "darwin_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_arm64 "\"") }
    else if (arch == "darwin_x86") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_x86 "\"") }
    else if (arch == "linux_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" linux_arm64 "\"") }
    else if (arch == "linux_x86") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" linux_x86 "\"") }
  }
  print
}' "$FORMULA" > "${FORMULA}.tmp" && mv "${FORMULA}.tmp" "$FORMULA"

echo "Formula updated successfully"
```

### 2. Update `.github/workflows/release.yml`

Add after the Slack notification step:

```yaml
  update-homebrew-tap:
    needs: [goreleaser]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Extract version from tag
        id: version
        run: |
          VERSION="${GITHUB_REF_NAME#specstory-cli/v}"
          echo "version=$VERSION" >> "$GITHUB_OUTPUT"

      - name: Download release artifacts
        run: |
          mkdir -p dist
          gh release download "$GITHUB_REF_NAME" --pattern "SpecStoryCLI_*.tar.gz" --dir dist
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Compute SHA256 hashes
        id: hashes
        run: |
          echo "darwin_arm64=$(shasum -a 256 dist/SpecStoryCLI_Darwin_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
          echo "darwin_x86_64=$(shasum -a 256 dist/SpecStoryCLI_Darwin_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
          echo "linux_arm64=$(shasum -a 256 dist/SpecStoryCLI_Linux_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
          echo "linux_x86_64=$(shasum -a 256 dist/SpecStoryCLI_Linux_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"

      - name: Checkout homebrew-tap
        uses: actions/checkout@v4
        with:
          repository: specstoryai/homebrew-tap
          token: ${{ secrets.HOMEBREW_TAP_TOKEN }}
          path: homebrew-tap

      - name: Update formula
        run: |
          ./scripts/update-homebrew-formula.sh \
            homebrew-tap/Formula/specstory.rb \
            "${{ steps.version.outputs.version }}" \
            "${{ steps.hashes.outputs.darwin_arm64 }}" \
            "${{ steps.hashes.outputs.darwin_x86_64 }}" \
            "${{ steps.hashes.outputs.linux_arm64 }}" \
            "${{ steps.hashes.outputs.linux_x86_64 }}"

      - name: Commit and push
        run: |
          cd homebrew-tap
          git config user.name "specstory-bot"
          git config user.email "actions@github.com"
          git add Formula/specstory.rb
          git commit -m "Release specstory v${{ steps.version.outputs.version }}"
          git push
```

Add step to update GitHub release notes with changelog (after GoReleaser, before Slack):

```yaml
      - name: Update release notes with changelog
        run: |
          VERSION="${GITHUB_REF_NAME#specstory-cli/}"
          CHANGELOG=$(awk -v version="$VERSION" 'BEGIN{p=0} /^## /{if ($0 ~ "^## " version){p=1; next} else if (p==1 && /^## /){exit}} p==1{print}' specstory-cli/changelog.md)
          if [ -n "$CHANGELOG" ]; then
            gh release edit "$GITHUB_REF_NAME" --notes "$CHANGELOG"
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### 3. Required Secret

Add `HOMEBREW_TAP_TOKEN` - GitHub PAT with write access to `specstoryai/homebrew-tap`.

### 4. Rewrite `specstory-cli/docs/CLI-RELEASE.md`

Follow the format from `../intent/HOMEBREW-RELEASE.md`:
- Release steps at top (numbered list)
- Reference content below explaining automation
- Workflow jobs table
- Required secrets table
- Troubleshooting section

## Verification

1. Create a test release tag
2. Verify GitHub release has changelog in notes
3. Verify homebrew-tap updated with correct version and SHA256s
4. Run `brew update && brew upgrade specstory` to verify


If you need specific details from before exiting plan mode (like exact code snippets, error messages, or content you generated), read the full transcript at: /Users/sean/.claude/projects/-Users-sean-source-SpecStory-getspecstory/a8a2d769-f294-46f2-a17b-9d067b8b1616.jsonl

---

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:26.488Z)**_

<think><details><summary>Thought Process</summary>
The user wants me to implement a plan to automate the SpecStory CLI release workflow. Let me break down what needs to be done:

1. Create `scripts/update-homebrew-formula.sh` - A new script to update the homebrew formula
2. Update `.github/workflows/release.yml` - Add the `update-homebrew-tap` job and release notes step
3. Rewrite `specstory-cli/docs/CLI-RELEASE.md` - Following the format from `../intent/HOMEBREW-RELEASE.md`

Let me start by reading the existing files to understand the current state:
1. The existing release.yml workflow
2. The existing CLI-RELEASE.md
3. The intent/HOMEBREW-RELEASE.md for reference formatting

I'll read these files in parallel to get started.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:26.860Z)**_

I'll implement this plan. Let me start by reading the existing files to understand the current state.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:27.306Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `./.github/workflows/release.yml`
```
     1‚Üíname: Release CLI
     2‚Üí
     3‚Üíon:
     4‚Üí  push:
     5‚Üí    tags:
     6‚Üí      - 'specstory-cli/v*'
     7‚Üí
     8‚Üípermissions:
     9‚Üí  contents: write
    10‚Üí
    11‚Üíjobs:
    12‚Üí  goreleaser:
    13‚Üí    runs-on: ubuntu-latest
    14‚Üí    environment: production
    15‚Üí    steps:
    16‚Üí      - uses: actions/checkout@v4
    17‚Üí        with:
    18‚Üí          fetch-depth: 0
    19‚Üí      - uses: actions/setup-go@v4
    20‚Üí        with:
    21‚Üí          go-version: '1.21'
    22‚Üí      - name: Extract version from tag
    23‚Üí        id: version
    24‚Üí        run: echo "version=${GITHUB_REF_NAME#specstory-cli/}" >> $GITHUB_OUTPUT
    25‚Üí
    26‚Üí      - uses: goreleaser/goreleaser-action@v6
    27‚Üí        with:
    28‚Üí          version: "~> v2"
    29‚Üí          args: release --clean --skip=validate
    30‚Üí        env:
    31‚Üí          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    32‚Üí          POSTHOG_API_KEY: ${{ secrets.POSTHOG_API_KEY }}
    33‚Üí          GORELEASER_CURRENT_TAG: ${{ steps.version.outputs.version }}
    34‚Üí
    35‚Üí      - name: Collect release details
    36‚Üí        id: release_details
    37‚Üí        continue-on-error: true
    38‚Üí        run: |
    39‚Üí            # Extract version from git tag (github.ref_name will be like "specstory-cli/v1.0.0")
    40‚Üí            VERSION="${{ github.ref_name }}"
    41‚Üí            VERSION="${VERSION#specstory-cli/}"  # Strip the subdirectory prefix
    42‚Üí            # Extract changelog for this version from specstory-cli/changelog.md
    43‚Üí            # The changelog format is: ## v0.13.0 2025-10-26
    44‚Üí            CHANGELOG=$(awk -v version="$VERSION" 'BEGIN{p=0} /^## /{if ($0 ~ "^## " version){p=1; next} else if (p==1 && /^## /){exit}} p==1{print}' specstory-cli/changelog.md)
    45‚Üí            {
    46‚Üí              echo "version=$VERSION"
    47‚Üí              echo "changelog<<CHANGELOG_EOF"
    48‚Üí              echo "$CHANGELOG"
    49‚Üí              echo "CHANGELOG_EOF"
    50‚Üí            } >> "$GITHUB_OUTPUT"
    51‚Üí
    52‚Üí      - name: Notify Slack (#clients)
    53‚Üí        env:
    54‚Üí            SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL_CLIENTS }}
    55‚Üí            VERSION: ${{ steps.release_details.outputs.version || 'unknown version' }}
    56‚Üí            CHANGELOG: ${{ steps.release_details.outputs.changelog || 'failed collecting release details' }}
    57‚Üí        run: |
    58‚Üí            {
    59‚Üí              printf "\n\nChangelog:\n%s\n" "$CHANGELOG"
    60‚Üí            } > message.txt
    61‚Üí
    62‚Üí            TITLE="*CLI $VERSION released*"
    63‚Üí            jq -n \
    64‚Üí              --rawfile text message.txt \
    65‚Üí              --arg title "$TITLE" \
    66‚Üí              --arg username "SpecStory Release Bot" \
    67‚Üí              --arg icon ":specstory:" \
    68‚Üí              '{
    69‚Üí                username: $username,
    70‚Üí                icon_emoji: $icon,
    71‚Üí                attachments: [
    72‚Üí                  {
    73‚Üí                    color: "#e35a2c",
    74‚Üí                    blocks: [
    75‚Üí                      {
    76‚Üí                        "type": "section",
    77‚Üí                        "text": { "type": "mrkdwn", "text": $title }
    78‚Üí                      },
    79‚Üí                      {
    80‚Üí                        "type": "section",
    81‚Üí                        "text": { "type": "mrkdwn", "text": $text }
    82‚Üí                      }
    83‚Üí                    ]
    84‚Üí                  }
    85‚Üí                ]
    86‚Üí              }' > payload.json
    87‚Üí            curl -X POST -H 'Content-type: application/json' --data @payload.json "$SLACK_WEBHOOK_URL"
    88‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:27.783Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `./specstory-cli/docs/CLI-RELEASE.md`
```
     1‚Üí# Releasing SpecStory CLI to Homebrew
     2‚Üí
     3‚ÜíThe following steps are required to release a new version of the SpecStory CLI to Homebrew.
     4‚Üí
     5‚ÜíThis is as-of January 16, 2026. Much of this will be automated in the future.
     6‚Üí
     7‚Üí## Repositories
     8‚Üí
     9‚Üí- **Source and Release repo**: `specstoryai/getspecstory` (public) - source code, CI/CD and release artifacts
    10‚Üí- **Homebrew tap**: `specstoryai/homebrew-tap` (public) - contains the Homebrew formula
    11‚Üí
    12‚Üí## Prepare the Release
    13‚Üí
    14‚ÜíOnce you have the `dev` branch where you want it for a release, merge the branch into `main`.
    15‚Üí
    16‚Üí## Tag the Release
    17‚Üí
    18‚ÜíOnce the `main` branch is ready for a release, tag the release with the version number. Update the version number in the tag message to the new version number:
    19‚Üí
    20‚Üí```zsh
    21‚Üígit tag -a specstory-cli/v1.0.0 -m "Release v1.0.0"
    22‚Üígit push origin specstory-cli/v1.0.0
    23‚Üí```
    24‚Üí
    25‚ÜíThis will trigger the [GitHub Action](../../.github/workflows/release.yml) to build the release and push it to the [GitHub Releases page](https://github.com/specstoryai/getspecstory/releases).
    26‚Üí
    27‚ÜíThe steps the GitHub Action will take are:
    28‚Üí
    29‚Üí1. Build binaries for all platforms using GoReleaser
    30‚Üí2. Create a GitHub release with the built artifacts
    31‚Üí3. Notify Slack of the release
    32‚Üí
    33‚ÜíYou can monitor the [GitHub Action's progress](https://github.com/specstoryai/getspecstory/actions).
    34‚Üí
    35‚Üí## Check the Release
    36‚Üí
    37‚ÜíGo to the [GitHub Releases page](https://github.com/specstoryai/getspecstory/releases) of the `specstoryai/getspecstory` repository and check that the release is there.
    38‚Üí
    39‚Üí## Update the Changelog
    40‚Üí
    41‚ÜíClick the pencil icon to edit the changelog for the new release. Copy the changelog from the [changelog.md](../changelog.md) file and paste it into the changelog.
    42‚Üí
    43‚Üí## Get the SHA256 Hashes of the Released Binaries
    44‚Üí
    45‚ÜíUpdate the version number in the URLs to the new version number:
    46‚Üí
    47‚Üí```zsh
    48‚Üícurl -sL https://github.com/specstoryai/getspecstory/releases/download/v1.0.0/SpecStoryCLI_Darwin_arm64.tar.gz | shasum -a 256
    49‚Üícurl -sL https://github.com/specstoryai/getspecstory/releases/download/v1.0.0/SpecStoryCLI_Darwin_x86_64.tar.gz | shasum -a 256
    50‚Üícurl -sL https://github.com/specstoryai/getspecstory/releases/download/v1.0.0/SpecStoryCLI_Linux_arm64.tar.gz | shasum -a 256
    51‚Üícurl -sL https://github.com/specstoryai/getspecstory/releases/download/v1.0.0/SpecStoryCLI_Linux_x86_64.tar.gz | shasum -a 256
    52‚Üí```
    53‚Üí
    54‚ÜíThis will give you the SHA256 hashes of the released binaries. e.g.:
    55‚Üí
    56‚Üí```
    57‚Üíae450eedf178706773826be43824bab7a90723c00b2165e3883d59da745f0de6  -
    58‚Üíf89e987151add16939ba78cc79b27c3c6aa08e7357ed47712acfd3c2843e1d94  -
    59‚Üífad9d81ab07102e47da37004166ff687923ec3a6fb0a250a60315c36d0f10b01  -
    60‚Üí30501cb6196d4bbc39ea2bf6834500d07063db20a42fe060090dcdbeef589cf2  -
    61‚Üí```
    62‚Üí
    63‚Üí## Update the Homebrew Formula
    64‚Üí
    65‚ÜíUpdate the version number in the Homebrew formula to the new version number.
    66‚Üí
    67‚ÜíUpdate the [Homebrew formula](https://github.com/specstoryai/homebrew-tap/blob/main/Formula/specstory.rb) in the [specstoryai/homebrew-tap](https://github.com/specstoryai/homebrew-tap) repository with the new SHA256 hashes you got from the cURL commands above.
    68‚Üí
    69‚ÜíThe 4 URLs in the Homebrew formula are in the same order as the 4 binaries you got the SHA256 hashes for above.
    70‚Üí
    71‚ÜíClick the pencil icon to edit the Homebrew formula. Update the 4 URLs in the Homebrew formula with the new URLs you got from the cURL commands above.
    72‚Üí
    73‚ÜíClick the "Commit changes" button to commit the changes to the Homebrew formula.
    74‚Üí
    75‚ÜíChange the commit message to something like "Release v1.0.0" and click the "Commit changes" button to commit the changes to the Homebrew formula.
    76‚Üí
    77‚Üí## Verify Update Notice in Old Version
    78‚Üí
    79‚ÜíRun your existing version of the CLI and verify that you get a notice that the new version is available.
    80‚Üí
    81‚Üí```zsh
    82‚Üíspecstory version
    83‚Üí```
    84‚Üí
    85‚Üí## Verify the Homebrew Release
    86‚Üí
    87‚ÜíUpgrade the CLI to the new version:
    88‚Üí
    89‚Üí```zsh
    90‚Üíbrew tap specstoryai/homebrew-tap
    91‚Üíbrew update
    92‚Üíbrew upgrade specstory
    93‚Üí```
    94‚Üí
    95‚ÜíThis should show the new version number:
    96‚Üí
    97‚Üí```zsh
    98‚Üíspecstory version
    99‚Üí```
   100‚Üí
   101‚Üí## Update the Product Documentation
   102‚Üí
   103‚Üí### Update the Version Number for Linux Download in the Documentation
   104‚Üí
   105‚ÜíUpdate the version number in the Linux download section of the [Mintlify documentation](https://dashboard.mintlify.com/specstory/specstory/editor/main) to the new version number.
   106‚Üí
   107‚ÜíNavigate to `./specstory/introduction.mdx` in the [Mintlify UI](https://dashboard.mintlify.com/specstory/specstory/editor/main) and scroll to the "SpecStory CLI for Terminal Agents" section, and the "Download Linux/WSL Binary" tab.
   108‚Üí
   109‚ÜíUpdate the version number in the "Linux (ARM64)" and "Linux (x86)" links.
   110‚Üí
   111‚Üí### Update Any Product/Feature Changes in the Documentation
   112‚Üí
   113‚ÜíScan the `./specstory` documentation in the [Mintlify documentation](https://dashboard.mintlify.com/specstory/specstory/editor/main) and update any product/feature changes in the documentation.
   114‚Üí
   115‚Üí### Publish the Documentation
   116‚Üí
   117‚ÜíClick the "Publish" button in the top right corner of the [Mintlify UI](https://dashboard.mintlify.com/specstory/specstory/editor/main) to publish the documentation changes.
   118‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:28.266Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `./intent/HOMEBREW-RELEASE.md`
```
<tool_use_error>File does not exist.</tool_use_error>
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:28.632Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `./specstory-cli/changelog.md`
```
     1‚Üí# Specstory CLI Changelog
     2‚Üí
     3‚Üí## v1.0.0 2026-01-16
     4‚Üí
     5‚Üí### üì¢ Announcements
     6‚Üí
     7‚Üí- Now that the SpecStory CLI is open sourced under the [Apache 2.0 license](https://github.com/specstoryai/getspecstory/blob/main/specstory-cli/LICENSE.txt) at [https://github.com/specstoryai/getspecstory/tree/main/specstory-cli](https://github.com/specstoryai/getspecstory/tree/main/specstory-cli) it is now also graduating to `v1.0.0` üéâ 
     8‚Üí
     9‚Üí### ‚öôÔ∏è Improvements
    10‚Üí
    11‚Üí- When logged in to [SpecStory Cloud](https://cloud.specstory.com/), show links to your project or session after `sync` or `run`.
    12‚Üí
    13‚Üí## v0.18.0 2026-01-16
    14‚Üí
    15‚Üí### üì¢ Announcements
    16‚Üí
    17‚Üí- The SpecStory CLI is now open sourced under the [Apache 2.0 license](https://github.com/specstoryai/getspecstory/blob/main/specstory-cli/LICENSE.txt) at [https://github.com/specstoryai/getspecstory/tree/main/specstory-cli](https://github.com/specstoryai/getspecstory/tree/main/specstory-cli) and [contributions](https://github.com/specstoryai/getspecstory/blob/main/specstory-cli/CONTRIBUTING.md) are welcome!
    18‚Üí
    19‚Üí### ‚öôÔ∏è Improvements
    20‚Üí
    21‚Üí- Include the agent's question in the markdown output from `AskUserQuestion` tool use with the Claude Code provider.
    22‚Üí
    23‚Üí## v0.17.0 2026-01-07
    24‚Üí
    25‚Üí### ‚öôÔ∏è Improvements
    26‚Üí
    27‚Üí- A major internal refactor was done to move markdown generation from the providers to the CLI layer, and to standardize the markdown output across all providers.
    28‚Üí- Updated the markdown version to `v2.1.0` with tool types standardized as ` write`, `read`, `search`, `shell`, `task`, `generic`, `unknown`, and with timestamps on all user and agent messages, where available.
    29‚Üí- The Cursor CLI provider now generates SpecStory markdown `v2.1.0` files, which support a significantly enhanced web UI when sessions are viewed in the SpecStory Cloud web app.
    30‚Üí- The Cursor CLI provider now preserves model "thinking" content in the markdown output.
    31‚Üí- The Claude Code provider now provides timestamps for user and agent messages in the markdown output.
    32‚Üí- The Claude Code provider no longer includes the `` content about malicious content in the generated markdown on "Read" tool results.
    33‚Üí- The Codex CLI provider has improved markdown output for the `shell_command` tool.
    34‚Üí
    35‚Üí### üêõ Bug Fixes
    36‚Üí
    37‚Üí- Fixed an issue where the CLI would still initialize the analytics client library when the `--no-usage-analytics` flag was used.
    38‚Üí
    39‚Üí## v0.16.0 2025-11-21
    40‚Üí
    41‚Üí### ‚öôÔ∏è Improvements
    42‚Üí
    43‚Üí- The SpecStory CLI now supports Google's [Gemini CLI](https://github.com/google-gemini/gemini-cli) (i.e. `gemini`) for sessions created from Gemini CLI version `0.15.1` or higher. Sessions from earlier versions may work, but are not officially supported. This provides the same support for saving to local markdown files and to the SpecStory Cloud as for [Claude Code](https://claude.ai/docs/api/claude-code), [Cursor CLI](https://cursor.com/docs/cli) and [Codex CLI](https://developers.openai.com/codex/cli/).
    44‚Üí
    45‚Üí### üêõ Bug Fixes
    46‚Üí
    47‚Üí- Fixed an issue where the Cursor CLI provider would not find sessions when a symlink was anywhere in the current working directory.
    48‚Üí
    49‚Üí## v0.15.0 2025-11-15
    50‚Üí
    51‚Üí### ‚öôÔ∏è Improvements
    52‚Üí
    53‚Üí- The Codex CLI provider now generates SpecStory markdown v2.0.0 files, which support a significantly enhanced web UI when sessions are viewed in the SpecStory Cloud web app.
    54‚Üí- The Codex CLI provider now supports markdown output for the `apply_patch` tool, which is used to apply a patch to a file.
    55‚Üí
    56‚Üí## v0.14.1 2025-11-14
    57‚Üí
    58‚Üí### üêõ Bug Fixes
    59‚Üí
    60‚Üí- `specstory run` with the Claude Code provider no longer creates additional markdown files for "Warmup" messages.
    61‚Üí- `specstory run` would give SpecStory Cloud sync stats timeout count of n - 1 sessions, where n is the number of incremental syncs attempted. This has been fixed.
    62‚Üí
    63‚Üí## v0.14.0 2025-11-12
    64‚Üí
    65‚Üí### ‚öôÔ∏è Improvements
    66‚Üí
    67‚Üí- The Claude Code provider now skips putting "Warmup" messages in the markdown output.
    68‚Üí- The Claude Code provider now generates SpecStory markdown v2.0.0 files, which support a significantly enhanced web UI when sessions are viewed in the SpecStory Cloud web app.
    69‚Üí- "Bash" tool use now supports multi-line commands in the markdown output for the Claude Code provider.
    70‚Üí- "Grep" tool use now extracts the pattern and path from the tool use arguments and displays them in the markdown output for the Claude Code provider.
    71‚Üí- Reduced network activity during more efficient bulk SpecStory Cloud syncs.
    72‚Üí- Display count of session syncs that timed out during SpecStory Cloud syncs.
    73‚Üí- Increased the timeout for SpecStory Cloud syncs to 120 seconds to account for initial syncs of large projects with many sessions.
    74‚Üí
    75‚Üí## v0.13.0 2025-10-26
    76‚Üí
    77‚Üí### ‚öôÔ∏è Improvements
    78‚Üí
    79‚Üí- Introduced a SpecStory Cloud sync debounce in `specstory run` to reduce the number of network syncs to the SpecStory Cloud.
    80‚Üí- Removed the `<user_query>` tags around user messages in the markdown file names and markdown content that's output from newer versions of the Cursor CLI.
    81‚Üí
    82‚Üí### üêõ Bug Fixes
    83‚Üí
    84‚Üí- Fixed the SpecStory cloud counters displayed after `specstory run` to match the actual number of sessions created/updated/skipped.
    85‚Üí
    86‚Üí## v0.12.0 2025-10-23
    87‚Üí
    88‚Üí### ‚öôÔ∏è Improvements
    89‚Üí
    90‚Üí- Skip the synthetic "warmup" user message that's always present in newer Claude Code sessions to generate more unique slugs for SpecStory history markdown filenames.
    91‚Üí- A pure Go SQLite library now replaces the C-based SQLite library for Cursor CLI provider database operations, improving cross-platform compatibility and performance.
    92‚Üí
    93‚Üí## v0.11.0 2025-10-05
    94‚Üí
    95‚Üí### ‚öôÔ∏è Improvements
    96‚Üí
    97‚Üí- The SpecStory CLI now supports OpenAI's [Codex CLI](https://developers.openai.com/codex/cli/) (i.e. `codex`) for sessions created from Codex CLI version `0.42.0` or higher. Sessions from earlier versions may work, but are not officially supported. This provides the same support for saving to local markdown files and to the SpecStory Cloud as for [Claude Code](https://claude.ai/docs/api/claude-code) and [Cursor CLI](https://cursor.com/docs/cli).
    98‚Üí
    99‚Üí
   100‚Üí## v0.10.1 2025-09-30
   101‚Üí
   102‚Üí### üêõ Bug Fixes
   103‚Üí
   104‚Üí- Fixed an issue where the CLI would abort when encountering JSON in a Claude Code JSONL file that was larger than 10MB [issue #108](https://github.com/specstoryai/getspecstory/issues/108) The new limit is 250MB.
   105‚Üí
   106‚Üí
   107‚Üí## v0.10.0 2025-09-26
   108‚Üí
   109‚Üí### ‚öôÔ∏è Improvements
   110‚Üí
   111‚Üí- The SpecStory CLI now supports the [Cursor CLI](https://cursor.com/cli) (i.e. `cursor-agent`) for sessions created from Cursor CLI version `2025.09.18-7ae6800` or higher. Sessions from earlier versions may work, but are not officially supported. This provides the same support for saving to local markdown files and to the SpecStory Cloud as for [Claude Code](https://claude.ai/docs/api/claude-code).
   112‚Üí
   113‚Üí### üîß CLI Configuration & Commands
   114‚Üí
   115‚Üí- The `check`, `run` and `sync` commands now take an optional `<agent-provider>` argument to specify the provider to use for the command, e.g. `specstory check claude`, `specstory run cursor`, or `specstory sync claude`,  if unspecified it defaults to `claude` for `run` and both providers for `check` and `sync`
   116‚Üí- The `-s` / `--session` flag replaces the `-u` / `--session-uuid` flag to specify a specific session ID for the `sync` command 
   117‚Üí- The `--command` flag replaces the `--claude-code-cmd` flag to specify a custom command to run the agent
   118‚Üí
   119‚Üí## v0.9.1 2025-09-10
   120‚Üí
   121‚Üí### üêõ Bug Fixes
   122‚Üí
   123‚Üí- Fixed an issue where special characters in the project name were not being properly handled to find the Claude Code project directory [issue #102](https://github.com/specstoryai/getspecstory/issues/102)
   124‚Üí- Fixed an issue where a symlink anywhere in the project directory was not being properly handled to find the Claude Code project directory [issue #85](https://github.com/specstoryai/getspecstory/issues/85)
   125‚Üí
   126‚Üí
   127‚Üí## v0.9.0 2025-09-07
   128‚Üí
   129‚Üí### ‚öôÔ∏è Improvements
   130‚Üí
   131‚Üí- Search across all your AI Chat history with the [SpecStory Cloud](https://cloud.specstory.com) web app
   132‚Üí- Automatically synchronize your Claude Code AI chat sessions with SpecStory Cloud, when logged in, using `specstory sync` and `specstory run`
   133‚Üí
   134‚Üí### üîß CLI Configuration & Commands
   135‚Üí
   136‚Üí- Login to SpecStory Cloud using `specstory login`, logout using `specstory logout`
   137‚Üí- Skip cloud sync, when logged in, using the `--no-cloud-sync` flag
   138‚Üí
   139‚Üí### üêõ Bug Fixes
   140‚Üí
   141‚Üí- Don't create a new markdown file for a resumed or compacted session, append the resumed session to the existing markdown file
   142‚Üí- Fixed stray usage output during non-usage related errors
   143‚Üí- Fixed stray log output to stdout when running `specstory -v`, `specstory --version`, `specstory --help`, `specstory -h`, and invalid flags.
   144‚Üí
   145‚Üí
   146‚Üí## v0.8.0 2025-08-06
   147‚Üí
   148‚Üí### ‚öôÔ∏è Improvements
   149‚Üí
   150‚Üí- Skip writing markdown files for sessions that have no user messages, this is especially useful to avoid creating empty markdown files when using interactive mode (`specstory run`)
   151‚Üí- Improved the output of `specstory sync`, to include showing the progress of parsing and processing JSONL files
   152‚Üí
   153‚Üí### üîß CLI Configuration & Commands
   154‚Üí
   155‚Üí- Fancy-schmancy new SpecStory logo that shows for `specstory` and  `specstory help`
   156‚Üí
   157‚Üí### üêõ Bug Fixes
   158‚Üí
   159‚Üí- Use of `/clear` command in Claude Code was resulting in subsequent sessions that were not being written to markdown files
   160‚Üí- Use of `/compact` or force-compacting the history in Claude Code was resulting in subsequent sessions that were not being written to markdown files
   161‚Üí- Fixed stray log output to stdout when running `specstory run`, `specstory version`, and `specstory help`
   162‚Üí
   163‚Üí
   164‚Üí## v0.7.0 2025-08-04
   165‚Üí
   166‚Üí### ‚öôÔ∏è Improvements
   167‚Üí
   168‚Üí- `specstory check` now tells you where the `claude` command that SpecStory will use is located
   169‚Üí- Uses the Claude Code provided summary of the session as the header of the markdown file, if available
   170‚Üí- Normalized the header formatting of markdown files to match the Cursor/VSC extension's markdown
   171‚Üí- Improved the explanation provided when `specstory sync` is run in a directory that is not an existing Claude Code project directory
   172‚Üí- Creates a `.specstory/.project.json` file to track the project ID and name the project, in preparation for the future cloud sync feature in the CLI
   173‚Üí- Moved to structured logging with `log/slog`
   174‚Üí- Moved the log output (`--log` flag) to `.specstory/debug/debug.log` file
   175‚Üí- Improved the output of `specstory sync` to show the progress of parsing JSONL files and syncing markdown files
   176‚Üí
   177‚Üí### üîß CLI Configuration & Commands
   178‚Üí
   179‚Üí- New `--console` flag for the `run` and `sync` commands to enable error/warn/info debug output to stdout, replaces the `--verbose` flag
   180‚Üí- New `--debug` flag for the `run` and `sync` commands to enable debug level output to `--log` or `--console` output
   181‚Üí
   182‚Üí
   183‚Üí## v0.6.0 2025-07-17
   184‚Üí
   185‚Üí### ‚öôÔ∏è Improvements
   186‚Üí
   187‚Üí- Support for the new "Native binary installation" of Claude Code (`curl -fsSL claude.ai/install.sh | bash`) which results in a `~/.local/bin/claude` binary
   188‚Üí
   189‚Üí### üîß CLI Configuration & Commands
   190‚Üí
   191‚Üí- New `--output-dir` flag for the `sync` and `run` commands to specify the output directory for the markdown files and logs, [issue #86](https://github.com/specstoryai/getspecstory/issues/86)
   192‚Üí- Added `--resume <session-id>` flag to the `run` command to resume a specific session by ID
   193‚Üí
   194‚Üí### üêõ Bug Fixes
   195‚Üí
   196‚Üí- Fixed an issue where sometimes the `run` command would result in duplicate markdown files with slightly offset filename timestamps for the interactive session
   197‚Üí
   198‚Üí
   199‚Üí## v0.5.0 2025-07-14
   200‚Üí
   201‚Üí### ‚úèÔ∏è Markdown Enhancements
   202‚Üí
   203‚Üí- Include content from the agent `thinking` in the markdown output
   204‚Üí- Improved markdown formatting for agent tool use for "MultiEdit"
   205‚Üí- Indicate if tool use was successful or not in the markdown output
   206‚Üí- Fix the `---` separator between user messages and agent messages
   207‚Üí
   208‚Üí### ‚öôÔ∏è Improvements
   209‚Üí
   210‚Üí- No longer use a `.specstory/.history.json` file to track sessions
   211‚Üí
   212‚Üí### üîß CLI Configuration & Commands
   213‚Üí
   214‚Üí- More helpful output from `specstory check` when Claude Code installed and accessible
   215‚Üí- Helpful output from `specstory check` when Claude Code cannot be run
   216‚Üí
   217‚Üí### üì¶ Distribution & Build
   218‚Üí
   219‚Üí- Improved the version update check to include the new version number in the output
   220‚Üí
   221‚Üí### üêõ Bug Fixes
   222‚Üí
   223‚Üí- `--version` flag was not working, only the `version` command was working
   224‚Üí- Fixed duplicate output of error messages
   225‚Üí
   226‚Üí
   227‚Üí## v0.4.0 2025-07-09
   228‚Üí
   229‚Üí### ‚úèÔ∏è Markdown Enhancements
   230‚Üí
   231‚Üí- Improved markdown formatting for agent tools use for "Bash", "Write", "Read" and "Grep"
   232‚Üí- Change attribution of chats from Claude Code to "Agent" rather than "Assistant"
   233‚Üí- Include the model and model version in the "Agent" attribution
   234‚Üí- Don't include the `isMeta`/`true` user messages "Caveat: The messages below were generated by the user.." in the markdown file
   235‚Üí- Good markdown formatting for `/` commands entered by the user in Claude Code
   236‚Üí- Better markdown file naming by skipping `isMeta` and `/` commands from the user message for naming the filename
   237‚Üí- Don't include the `` about malicious content in the generated markdown on "Read" tool results
   238‚Üí
   239‚Üí### üîß CLI Configuration & Commands
   240‚Üí
   241‚Üí- Moved from a flag based CLI to one based on commands
   242‚Üí  - Commands for: `run`, `sync`, `check`, `help`, `version`
   243‚Üí  - Flags for: `--log`, `--verbose`, `--silent`, `--no-version-check`, `--no-usage-analytics`
   244‚Üí- Command specific help, e.g. `specstory help sync`
   245‚Üí- Fully styled help via [Fang](https://github.com/charmbracelet/fang)
   246‚Üí- Improved help text and example usage
   247‚Üí
   248‚Üí### üêõ Bug Fixes
   249‚Üí
   250‚Üí- Remove the proactive check for Claude Code in the PATH, as this no longer works with Anthropic's self-managed install approach (`~/.claude/local/claude` with a `claude` alias)
   251‚Üí- Instead of defaulting to `claude` when no Claude Code Command (`-c`) is provided, first check for the presence of `~/.claude/local/claude` and use that as the default if present, to work with Anthropic's self-managed install approach
   252‚Üí- If `~` is used in the Claude Code Command (`-c`) it was being treated literally, rather than expanded
   253‚Üí
   254‚Üí
   255‚Üí## v0.3.0 2025-07-03
   256‚Üí
   257‚Üí### ‚úèÔ∏è Markdown Enhancements
   258‚Üí
   259‚Üí- Generate markdown files with formatted todos including priority indicators (üî•/üå°Ô∏è/‚ùÑÔ∏è) and completion status (`[ ]`, `[‚ö°]`, `[X]`) for the `TodoWrite` tool
   260‚Üí
   261‚Üí### ‚öôÔ∏è Improvements
   262‚Üí
   263‚Üí- Added progress and summary output to runs of the `-s` sync markdown command
   264‚Üí- Add result output to runs of the `-u` single session command
   265‚Üí
   266‚Üí### üîß CLI Configuration & Commands
   267‚Üí
   268‚Üí- Added `--silent` mode to suppress output during single session (`-u`) or sync (`-s`)
   269‚Üí
   270‚Üí### üêõ Bug Fixes
   271‚Üí
   272‚Üí- Flag validation - Using `--silent` and `-v` flags together returns an error
   273‚Üí
   274‚Üí
   275‚Üí## v0.2.0 2025-07-01
   276‚Üí
   277‚Üí### ‚úèÔ∏è Markdown Enhancements
   278‚Üí
   279‚Üí- Now when the user message to Claude Code consists of just an image, or includes one or more images, `specstory` will include this fact in the generated markdown file.
   280‚Üí- Now when Claude Code breaks up user messages into multiple parts, `specstory` includes all the parts in the generated markdown file, not just the first part.
   281‚Üí
   282‚Üí### üêõ Bug Fixes
   283‚Üí
   284‚Üí- Fixed an issue where `specstory` would not find the Claude Code `~/.claude/projects` directory for the project if the project path contained the `_` character.
   285‚Üí- Fixed an issue where running with the `-u` flag when there was no `.specstory/history` directory would cause `specstory` to exit with an error
   286‚Üí
   287‚Üí
   288‚Üí## v0.1.0 2025-06-26
   289‚Üí
   290‚Üí### ‚öôÔ∏è Improvements
   291‚Üí
   292‚Üí- Deterministic filenames - Implemented deterministic filenames for consistent builds
   293‚Üí
   294‚Üí### üì¶ Distribution & Build
   295‚Üí
   296‚Üí- Automatic version checking - Check for newer versions of `specstory` and output a message if available
   297‚Üí- Version check bypass - Use `--no-version-check` to disable version checking for current run
   298‚Üí
   299‚Üí### üîß CLI Configuration & Commands
   300‚Üí
   301‚Üí- Installation verification - Added `--check-install` command for system validation
   302‚Üí- Logging control - New `--log` flag for enhanced debugging capabilities
   303‚Üí- Flag validation - Using `-s` and `-u` flags together now properly returns an error
   304‚Üí- Analytics control - Use `--no-usage-analytics` to disable analytics for current run
   305‚Üí- Version check bypass - Use `--no-version-check` to disable version checking for current run
   306‚Üí
   307‚Üí### üìä Analytics
   308‚Üí
   309‚Üí- Analytics control - Use `--no-usage-analytics` to disable analytics for current run
   310‚Üí- Session tracking - Enhanced analytics integration with configurable opt-out options
   311‚Üí
   312‚Üí### üêõ Bug Fixes
   313‚Üí
   314‚Üí- Sidechain stability - Fixed hanging issues in sidechain operations
   315‚Üí- Exception handling - Resolved exception errors in sidechain processing
   316‚Üí- Duplicate prevention - CLI no longer writes duplicate files
   317‚Üí- Major stability fix - Resolved critical stability issue (the big fix)
   318‚Üí
   319‚Üí
   320‚Üí
   321‚Üí## v0.0.3 2025-06-20
   322‚Üí
   323‚Üí### üì¶ Distribution & Build
   324‚Üí
   325‚Üí- Version updates - Update pinned CLI version
   326‚Üí
   327‚Üí### üìä Analytics
   328‚Üí
   329‚Üí- Shared analytics ID - CLI now sync analytics IDs (macOS only)
   330‚Üí- PostHog tracking - Added basic PostHog tracking of activated sessions when CLI runs in interactive mode
   331‚Üí
   332‚Üí
   333‚Üí
   334‚Üí## v0.0.2 2025-06-20
   335‚Üí
   336‚Üí### ‚úèÔ∏è Markdown Enhancements
   337‚Üí
   338‚Üí- Tool argument display - Show grep tool arguments in markdown output
   339‚Üí- Tool result messages - Tool outputs now properly display as assistant responses
   340‚Üí
   341‚Üí### ‚öôÔ∏è Improvements
   342‚Üí
   343‚Üí- Better error handling - No longer checks if CLI path exists, just tries to run and shows errors if they occur
   344‚Üí
   345‚Üí### üì¶ Distribution & Installation
   346‚Üí
   347‚Üí- Homebrew support - Fixed Homebrew setup and artifact URLs for easier installation
   348‚Üí- Dual archive format - CLI now distributed as both tar.gz and zip archives
   349‚Üí- Build improvements - Added ID to archives for better build tracking
   350‚Üí
   351‚Üí### üîß CLI Configuration & Commands
   352‚Üí
   353‚Üí- Verbose flag - Added `-v` verbose flag to show informational logging only when needed
   354‚Üí- Updated flags - Improved CLI flag handling and configuration
   355‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:32.895Z)**_

<think><details><summary>Thought Process</summary>
Now I have a good understanding of the current state. Let me look for the intent/HOMEBREW-RELEASE.md file - it seems the path was wrong. Let me search for it.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:33.398Z)**_

Let me search for the intent file to get the format reference.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:33.860Z)**_

<tool-use data-tool-type="search" data-tool-name="Glob"><details>
<summary>Tool use: **Glob**</summary>
 pattern `**/HOMEBREW-RELEASE.md`
```
No files found
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:34.192Z)**_

<tool-use data-tool-type="search" data-tool-name="Glob"><details>
<summary>Tool use: **Glob**</summary>
 pattern `intent/**/*.md`
```
No files found
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:39.309Z)**_

<think><details><summary>Thought Process</summary>
The intent/HOMEBREW-RELEASE.md file doesn't exist. Let me check if there's an intent directory or similar.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:39.727Z)**_

Let me check for an intent directory or similar reference documents.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:40.381Z)**_

<tool-use data-tool-type="shell" data-tool-name="Bash"><details>
<summary>Tool use: **Bash**</summary>
List root directory contents

`ls -la /Users/sean/source/SpecStory/getspecstory/`
```
total 112
drwxr-xr-x  15 sean  staff    480 Jan 23 12:27 .
drwxr-xr-x  13 sean  staff    416 Jan 23 12:25 ..
drwxr-xr-x   3 sean  staff     96 Jan 23 12:27 .claude
-rw-r--r--   1 sean  staff    110 Jan 13 11:28 .cursorindexingignore
drwxr-xr-x  16 sean  staff    512 Jan 23 12:38 .git
drwxr-xr-x   5 sean  staff    160 Jan 23 11:57 .github
-rw-r--r--   1 sean  staff     63 Jan 23 11:57 .gitignore
-rw-r--r--   1 sean  staff    822 Jan 23 11:57 .goreleaser.yml
drwxr-xr-x   6 sean  staff    192 Jan 23 12:17 .specstory
-rw-r--r--   1 sean  staff   8410 Jan 23 11:57 CODE-OF-CONDUCT.md
-rw-r--r--   1 sean  staff   1141 Jan 23 11:57 CONTRIBUTING.md
-rw-r--r--   1 sean  staff   1357 Jun 25  2025 install.sh
-rw-r--r--   1 sean  staff  11356 Jan 23 11:57 LICENSE.txt
-rw-r--r--   1 sean  staff   8576 Jan 23 11:57 README.md
drwxr-xr-x  19 sean  staff    608 Jan 23 11:57 specstory-cli
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:47.420Z)**_

<think><details><summary>Thought Process</summary>
There's no `intent` directory. The plan mentions `../intent/HOMEBREW-RELEASE.md` format, but that file doesn't exist. I'll need to follow the general format described in the plan instead. Let me now proceed with the implementation:

1. Create `scripts/update-homebrew-formula.sh`
2. Update `.github/workflows/release.yml`
3. Rewrite `specstory-cli/docs/CLI-RELEASE.md`

Let me first create the scripts directory and the script, then update the workflow, and finally rewrite the release documentation.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:48.097Z)**_

The intent file doesn't exist, but the plan describes the format to follow. Let me proceed with the implementation.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:48.601Z)**_

<tool-use data-tool-type="shell" data-tool-name="Bash"><details>
<summary>Tool use: **Bash**</summary>
Create scripts directory

`mkdir -p /Users/sean/source/SpecStory/getspecstory/scripts`
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:38:52.204Z)**_

<think><details><summary>Thought Process</summary>
Now let me create the update-homebrew-formula.sh script.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:01.514Z)**_

<tool-use data-tool-type="write" data-tool-name="Write"><details>
<summary>Tool use: **Write**</summary>

```sh
#!/usr/bin/env bash
# Updates the Homebrew formula with new version and SHA256 hashes.
# Usage: update-homebrew-formula.sh <formula_path> <version> \
#        <sha_darwin_arm64> <sha_darwin_x86_64> <sha_linux_arm64> <sha_linux_x86_64>

set -euo pipefail

FORMULA="$1"
VERSION="$2"
SHA_DARWIN_ARM64="$3"
SHA_DARWIN_X86_64="$4"
SHA_LINUX_ARM64="$5"
SHA_LINUX_X86_64="$6"

# Validate inputs
if [[ ! -f "$FORMULA" ]]; then
  echo "Error: Formula file not found: $FORMULA" >&2
  exit 1
fi

for sha in "$SHA_DARWIN_ARM64" "$SHA_DARWIN_X86_64" "$SHA_LINUX_ARM64" "$SHA_LINUX_X86_64"; do
  if [[ ! "$sha" =~ ^[a-f0-9]{64}$ ]]; then
    echo "Error: Invalid SHA256 hash: $sha" >&2
    exit 1
  fi
done

echo "Updating formula: $FORMULA"
echo "  Version: $VERSION"

# Update version using sed (temp file for macOS compatibility)
sed "s/^  version \".*\"/  version \"${VERSION}\"/" "$FORMULA" > "${FORMULA}.tmp"
mv "${FORMULA}.tmp" "$FORMULA"

# Context-aware SHA256 update using awk
awk -v darwin_arm64="$SHA_DARWIN_ARM64" \
    -v darwin_x86="$SHA_DARWIN_X86_64" \
    -v linux_arm64="$SHA_LINUX_ARM64" \
    -v linux_x86="$SHA_LINUX_X86_64" '
{
  if (/Darwin_arm64/) { arch = "darwin_arm64" }
  else if (/Darwin_x86_64/) { arch = "darwin_x86" }
  else if (/Linux_arm64/) { arch = "linux_arm64" }
  else if (/Linux_x86_64/) { arch = "linux_x86" }

  if (/sha256 "[a-f0-9]{64}"/) {
    if (arch == "darwin_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_arm64 "\"") }
    else if (arch == "darwin_x86") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_x86 "\"") }
    else if (arch == "linux_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" linux_arm64 "\"") }
    else if (arch == "linux_x86") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" linux_x86 "\"") }
  }
  print
}' "$FORMULA" > "${FORMULA}.tmp" && mv "${FORMULA}.tmp" "$FORMULA"

echo "Formula updated successfully"

```
```
File created successfully at: /Users/sean/source/SpecStory/getspecstory/scripts/update-homebrew-formula.sh
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:04.201Z)**_

<think><details><summary>Thought Process</summary>
Now let me make the script executable.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:05.276Z)**_

<tool-use data-tool-type="shell" data-tool-name="Bash"><details>
<summary>Tool use: **Bash**</summary>
Make script executable

`chmod +x /Users/sean/source/SpecStory/getspecstory/scripts/update-homebrew-formula.sh`
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:19.330Z)**_

<think><details><summary>Thought Process</summary>
Now let me update the release.yml workflow. I need to:
1. Add the release notes update step after GoReleaser and before Slack
2. Add the `update-homebrew-tap` job after the goreleaser job

Let me carefully update the workflow.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:19.900Z)**_

Now let me update the release.yml workflow. I'll add the release notes step after GoReleaser and before Slack, and add the `update-homebrew-tap` job.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:29.848Z)**_

<tool-use data-tool-type="write" data-tool-name="Edit"><details>
<summary>Tool use: **Edit**</summary>
```
The file /Users/sean/source/SpecStory/getspecstory/.github/workflows/release.yml has been updated successfully.
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:32.922Z)**_

<think><details><summary>Thought Process</summary>
Now I need to add the `update-homebrew-tap` job at the end of the file. Let me read the current state of the file to see where to add it.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:33.274Z)**_

Now let me add the `update-homebrew-tap` job at the end of the workflow.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:33.626Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `./.github/workflows/release.yml`
```
     1‚Üíname: Release CLI
     2‚Üí
     3‚Üíon:
     4‚Üí  push:
     5‚Üí    tags:
     6‚Üí      - 'specstory-cli/v*'
     7‚Üí
     8‚Üípermissions:
     9‚Üí  contents: write
    10‚Üí
    11‚Üíjobs:
    12‚Üí  goreleaser:
    13‚Üí    runs-on: ubuntu-latest
    14‚Üí    environment: production
    15‚Üí    steps:
    16‚Üí      - uses: actions/checkout@v4
    17‚Üí        with:
    18‚Üí          fetch-depth: 0
    19‚Üí      - uses: actions/setup-go@v4
    20‚Üí        with:
    21‚Üí          go-version: '1.21'
    22‚Üí      - name: Extract version from tag
    23‚Üí        id: version
    24‚Üí        run: echo "version=${GITHUB_REF_NAME#specstory-cli/}" >> $GITHUB_OUTPUT
    25‚Üí
    26‚Üí      - uses: goreleaser/goreleaser-action@v6
    27‚Üí        with:
    28‚Üí          version: "~> v2"
    29‚Üí          args: release --clean --skip=validate
    30‚Üí        env:
    31‚Üí          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    32‚Üí          POSTHOG_API_KEY: ${{ secrets.POSTHOG_API_KEY }}
    33‚Üí          GORELEASER_CURRENT_TAG: ${{ steps.version.outputs.version }}
    34‚Üí
    35‚Üí      - name: Collect release details
    36‚Üí        id: release_details
    37‚Üí        continue-on-error: true
    38‚Üí        run: |
    39‚Üí            # Extract version from git tag (github.ref_name will be like "specstory-cli/v1.0.0")
    40‚Üí            VERSION="${{ github.ref_name }}"
    41‚Üí            VERSION="${VERSION#specstory-cli/}"  # Strip the subdirectory prefix
    42‚Üí            # Extract changelog for this version from specstory-cli/changelog.md
    43‚Üí            # The changelog format is: ## v0.13.0 2025-10-26
    44‚Üí            CHANGELOG=$(awk -v version="$VERSION" 'BEGIN{p=0} /^## /{if ($0 ~ "^## " version){p=1; next} else if (p==1 && /^## /){exit}} p==1{print}' specstory-cli/changelog.md)
    45‚Üí            {
    46‚Üí              echo "version=$VERSION"
    47‚Üí              echo "changelog<<CHANGELOG_EOF"
    48‚Üí              echo "$CHANGELOG"
    49‚Üí              echo "CHANGELOG_EOF"
    50‚Üí            } >> "$GITHUB_OUTPUT"
    51‚Üí
    52‚Üí      - name: Update release notes with changelog
    53‚Üí        run: |
    54‚Üí          VERSION="${GITHUB_REF_NAME#specstory-cli/}"
    55‚Üí          CHANGELOG=$(awk -v version="$VERSION" 'BEGIN{p=0} /^## /{if ($0 ~ "^## " version){p=1; next} else if (p==1 && /^## /){exit}} p==1{print}' specstory-cli/changelog.md)
    56‚Üí          if [ -n "$CHANGELOG" ]; then
    57‚Üí            gh release edit "$GITHUB_REF_NAME" --notes "$CHANGELOG"
    58‚Üí          fi
    59‚Üí        env:
    60‚Üí          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    61‚Üí
    62‚Üí      - name: Notify Slack (#clients)
    63‚Üí        env:
    64‚Üí            SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL_CLIENTS }}
    65‚Üí            VERSION: ${{ steps.release_details.outputs.version || 'unknown version' }}
    66‚Üí            CHANGELOG: ${{ steps.release_details.outputs.changelog || 'failed collecting release details' }}
    67‚Üí        run: |
    68‚Üí            {
    69‚Üí              printf "\n\nChangelog:\n%s\n" "$CHANGELOG"
    70‚Üí            } > message.txt
    71‚Üí
    72‚Üí            TITLE="*CLI $VERSION released*"
    73‚Üí            jq -n \
    74‚Üí              --rawfile text message.txt \
    75‚Üí              --arg title "$TITLE" \
    76‚Üí              --arg username "SpecStory Release Bot" \
    77‚Üí              --arg icon ":specstory:" \
    78‚Üí              '{
    79‚Üí                username: $username,
    80‚Üí                icon_emoji: $icon,
    81‚Üí                attachments: [
    82‚Üí                  {
    83‚Üí                    color: "#e35a2c",
    84‚Üí                    blocks: [
    85‚Üí                      {
    86‚Üí                        "type": "section",
    87‚Üí                        "text": { "type": "mrkdwn", "text": $title }
    88‚Üí                      },
    89‚Üí                      {
    90‚Üí                        "type": "section",
    91‚Üí                        "text": { "type": "mrkdwn", "text": $text }
    92‚Üí                      }
    93‚Üí                    ]
    94‚Üí                  }
    95‚Üí                ]
    96‚Üí              }' > payload.json
    97‚Üí            curl -X POST -H 'Content-type: application/json' --data @payload.json "$SLACK_WEBHOOK_URL"
    98‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:37.017Z)**_

<think><details><summary>Thought Process</summary>
Now I need to add the `update-homebrew-tap` job at the end of the file. The file ends at line 98 with a blank line after the curl command. I'll add the new job there.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:45.249Z)**_

<tool-use data-tool-type="write" data-tool-name="Edit"><details>
<summary>Tool use: **Edit**</summary>
```
The file /Users/sean/source/SpecStory/getspecstory/.github/workflows/release.yml has been updated successfully.
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:50.054Z)**_

<think><details><summary>Thought Process</summary>
Now let me rewrite the CLI-RELEASE.md document. The plan says to follow the format from `../intent/HOMEBREW-RELEASE.md`:
- Release steps at top (numbered list)
- Reference content below explaining automation
- Workflow jobs table
- Required secrets table
- Troubleshooting section

Let me write the new CLI-RELEASE.md.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:39:50.485Z)**_

Now let me rewrite the CLI-RELEASE.md documentation with the new automated process.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:40:06.455Z)**_

<tool-use data-tool-type="write" data-tool-name="Write"><details>
<summary>Tool use: **Write**</summary>

```md
# Releasing SpecStory CLI

## Release Steps

1. Merge changes to `main` branch
2. Update `specstory-cli/changelog.md` with release notes
3. Tag and push the release:
   \```zsh
   git tag -a specstory-cli/v1.0.0 -m "Release v1.0.0"
   git push origin specstory-cli/v1.0.0
   \```
4. Monitor the [GitHub Action](https://github.com/specstoryai/getspecstory/actions)
5. Verify the [GitHub Release](https://github.com/specstoryai/getspecstory/releases) has correct changelog
6. Verify [homebrew-tap](https://github.com/specstoryai/homebrew-tap) was updated

## Verification

After release, verify the Homebrew installation works:

\```zsh
brew tap specstoryai/homebrew-tap
brew update
brew upgrade specstory
specstory version
\```

## What Gets Automated

The release workflow handles everything after you push the tag:

| Job | Description |
|-----|-------------|
| `goreleaser` | Builds binaries for all platforms, creates GitHub release |
| Release notes | Extracts changelog section and updates GitHub release notes |
| Slack notification | Posts release announcement to #clients channel |
| `update-homebrew-tap` | Updates formula with new version and SHA256 hashes |

## Required Secrets

| Secret | Purpose |
|--------|---------|
| `GITHUB_TOKEN` | Built-in token for release creation |
| `POSTHOG_API_KEY` | Analytics key embedded in binaries |
| `SLACK_WEBHOOK_URL_CLIENTS` | Slack notification webhook |
| `HOMEBREW_TAP_TOKEN` | PAT with write access to `specstoryai/homebrew-tap` |

## Repositories

- **Source**: [specstoryai/getspecstory](https://github.com/specstoryai/getspecstory) - CLI source code and releases
- **Homebrew tap**: [specstoryai/homebrew-tap](https://github.com/specstoryai/homebrew-tap) - Homebrew formula

## Troubleshooting

### Release notes not updated

Check that the version in `changelog.md` matches the tag format (e.g., `## v1.0.0` for tag `specstory-cli/v1.0.0`).

### Homebrew tap not updated

1. Verify `HOMEBREW_TAP_TOKEN` secret exists and has write access
2. Check the `update-homebrew-tap` job logs for errors
3. Verify all four artifacts were uploaded: `SpecStoryCLI_Darwin_arm64.tar.gz`, `SpecStoryCLI_Darwin_x86_64.tar.gz`, `SpecStoryCLI_Linux_arm64.tar.gz`, `SpecStoryCLI_Linux_x86_64.tar.gz`

### Manual homebrew update

If automation fails, update manually:

\```zsh
# Get SHA256 hashes
VERSION="1.0.0"
curl -sL "https://github.com/specstoryai/getspecstory/releases/download/specstory-cli/v${VERSION}/SpecStoryCLI_Darwin_arm64.tar.gz" | shasum -a 256
curl -sL "https://github.com/specstoryai/getspecstory/releases/download/specstory-cli/v${VERSION}/SpecStoryCLI_Darwin_x86_64.tar.gz" | shasum -a 256
curl -sL "https://github.com/specstoryai/getspecstory/releases/download/specstory-cli/v${VERSION}/SpecStoryCLI_Linux_arm64.tar.gz" | shasum -a 256
curl -sL "https://github.com/specstoryai/getspecstory/releases/download/specstory-cli/v${VERSION}/SpecStoryCLI_Linux_x86_64.tar.gz" | shasum -a 256
\```

Then update [Formula/specstory.rb](https://github.com/specstoryai/homebrew-tap/blob/main/Formula/specstory.rb) with the new version and hashes.

## Manual Steps Still Required

- Update Linux download links in [Mintlify documentation](https://dashboard.mintlify.com/specstory/specstory/editor/main) (`./specstory/introduction.mdx`)
- Update any product/feature changes in documentation
- Publish documentation changes

```
```
The file /Users/sean/source/SpecStory/getspecstory/specstory-cli/docs/CLI-RELEASE.md has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
     1‚Üí# Releasing SpecStory CLI
     2‚Üí
     3‚Üí## Release Steps
     4‚Üí
     5‚Üí1. Merge changes to `main` branch
     6‚Üí2. Update `specstory-cli/changelog.md` with release notes
     7‚Üí3. Tag and push the release:
     8‚Üí   ```zsh
     9‚Üí   git tag -a specstory-cli/v1.0.0 -m "Release v1.0.0"
    10‚Üí   git push origin specstory-cli/v1.0.0
    11‚Üí   ```
    12‚Üí4. Monitor the [GitHub Action](https://github.com/specstoryai/getspecstory/actions)
    13‚Üí5. Verify the [GitHub Release](https://github.com/specstoryai/getspecstory/releases) has correct changelog
    14‚Üí6. Verify [homebrew-tap](https://github.com/specstoryai/homebrew-tap) was updated
    15‚Üí
    16‚Üí## Verification
    17‚Üí
    18‚ÜíAfter release, verify the Homebrew installation works:
    19‚Üí
    20‚Üí```zsh
    21‚Üíbrew tap specstoryai/homebrew-tap
    22‚Üíbrew update
    23‚Üíbrew upgrade specstory
    24‚Üíspecstory version
    25‚Üí```
    26‚Üí
    27‚Üí## What Gets Automated
    28‚Üí
    29‚ÜíThe release workflow handles everything after you push the tag:
    30‚Üí
    31‚Üí| Job | Description |
    32‚Üí|-----|-------------|
    33‚Üí| `goreleaser` | Builds binaries for all platforms, creates GitHub release |
    34‚Üí| Release notes | Extracts changelog section and updates GitHub release notes |
    35‚Üí| Slack notification | Posts release announcement to #clients channel |
    36‚Üí| `update-homebrew-tap` | Updates formula with new version and SHA256 hashes |
    37‚Üí
    38‚Üí## Required Secrets
    39‚Üí
    40‚Üí| Secret | Purpose |
    41‚Üí|--------|---------|
    42‚Üí| `GITHUB_TOKEN` | Built-in token for release creation |
    43‚Üí| `POSTHOG_API_KEY` | Analytics key embedded in binaries |
    44‚Üí| `SLACK_WEBHOOK_URL_CLIENTS` | Slack notification webhook |
    45‚Üí| `HOMEBREW_TAP_TOKEN` | PAT with write access to `specstoryai/homebrew-tap` |
    46‚Üí
    47‚Üí## Repositories
    48‚Üí
    49‚Üí- **Source**: [specstoryai/getspecstory](https://github.com/specstoryai/getspecstory) - CLI source code and releases
    50‚Üí- **Homebrew tap**: [specstoryai/homebrew-tap](https://github.com/specstoryai/homebrew-tap) - Homebrew formula
    51‚Üí
    52‚Üí## Troubleshooting
    53‚Üí
    54‚Üí### Release notes not updated
    55‚Üí
    56‚ÜíCheck that the version in `changelog.md` matches the tag format (e.g., `## v1.0.0` for tag `specstory-cli/v1.0.0`).
    57‚Üí
    58‚Üí### Homebrew tap not updated
    59‚Üí
    60‚Üí1. Verify `HOMEBREW_TAP_TOKEN` secret exists and has write access
    61‚Üí2. Check the `update-homebrew-tap` job logs for errors
    62‚Üí3. Verify all four artifacts were uploaded: `SpecStoryCLI_Darwin_arm64.tar.gz`, `SpecStoryCLI_Darwin_x86_64.tar.gz`, `SpecStoryCLI_Linux_arm64.tar.gz`, `SpecStoryCLI_Linux_x86_64.tar.gz`
    63‚Üí
    64‚Üí### Manual homebrew update
    65‚Üí
    66‚ÜíIf automation fails, update manually:
    67‚Üí
    68‚Üí```zsh
    69‚Üí# Get SHA256 hashes
    70‚ÜíVERSION="1.0.0"
    71‚Üícurl -sL "https://github.com/specstoryai/getspecstory/releases/download/specstory-cli/v${VERSION}/SpecStoryCLI_Darwin_arm64.tar.gz" | shasum -a 256
    72‚Üícurl -sL "https://github.com/specstoryai/getspecstory/releases/download/specstory-cli/v${VERSION}/SpecStoryCLI_Darwin_x86_64.tar.gz" | shasum -a 256
    73‚Üícurl -sL "https://github.com/specstoryai/getspecstory/releases/download/specstory-cli/v${VERSION}/SpecStoryCLI_Linux_arm64.tar.gz" | shasum -a 256
    74‚Üícurl -sL "https://github.com/specstoryai/getspecstory/releases/download/specstory-cli/v${VERSION}/SpecStoryCLI_Linux_x86_64.tar.gz" | shasum -a 256
    75‚Üí```
    76‚Üí
    77‚ÜíThen update [Formula/specstory.rb](https://github.com/specstoryai/homebrew-tap/blob/main/Formula/specstory.rb) with the new version and hashes.
    78‚Üí
    79‚Üí## Manual Steps Still Required
    80‚Üí
    81‚Üí- Update Linux download links in [Mintlify documentation](https://dashboard.mintlify.com/specstory/specstory/editor/main) (`./specstory/introduction.mdx`)
    82‚Üí- Update any product/feature changes in documentation
    83‚Üí- Publish documentation changes
    84‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:40:09.701Z)**_

<think><details><summary>Thought Process</summary>
Now let me verify the final state of all the files I created/modified to make sure everything looks correct.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:40:10.191Z)**_

Let me verify all the files are correctly created and the workflow YAML is valid.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:40:10.665Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `./.github/workflows/release.yml`
```
     1‚Üíname: Release CLI
     2‚Üí
     3‚Üíon:
     4‚Üí  push:
     5‚Üí    tags:
     6‚Üí      - 'specstory-cli/v*'
     7‚Üí
     8‚Üípermissions:
     9‚Üí  contents: write
    10‚Üí
    11‚Üíjobs:
    12‚Üí  goreleaser:
    13‚Üí    runs-on: ubuntu-latest
    14‚Üí    environment: production
    15‚Üí    steps:
    16‚Üí      - uses: actions/checkout@v4
    17‚Üí        with:
    18‚Üí          fetch-depth: 0
    19‚Üí      - uses: actions/setup-go@v4
    20‚Üí        with:
    21‚Üí          go-version: '1.21'
    22‚Üí      - name: Extract version from tag
    23‚Üí        id: version
    24‚Üí        run: echo "version=${GITHUB_REF_NAME#specstory-cli/}" >> $GITHUB_OUTPUT
    25‚Üí
    26‚Üí      - uses: goreleaser/goreleaser-action@v6
    27‚Üí        with:
    28‚Üí          version: "~> v2"
    29‚Üí          args: release --clean --skip=validate
    30‚Üí        env:
    31‚Üí          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    32‚Üí          POSTHOG_API_KEY: ${{ secrets.POSTHOG_API_KEY }}
    33‚Üí          GORELEASER_CURRENT_TAG: ${{ steps.version.outputs.version }}
    34‚Üí
    35‚Üí      - name: Collect release details
    36‚Üí        id: release_details
    37‚Üí        continue-on-error: true
    38‚Üí        run: |
    39‚Üí            # Extract version from git tag (github.ref_name will be like "specstory-cli/v1.0.0")
    40‚Üí            VERSION="${{ github.ref_name }}"
    41‚Üí            VERSION="${VERSION#specstory-cli/}"  # Strip the subdirectory prefix
    42‚Üí            # Extract changelog for this version from specstory-cli/changelog.md
    43‚Üí            # The changelog format is: ## v0.13.0 2025-10-26
    44‚Üí            CHANGELOG=$(awk -v version="$VERSION" 'BEGIN{p=0} /^## /{if ($0 ~ "^## " version){p=1; next} else if (p==1 && /^## /){exit}} p==1{print}' specstory-cli/changelog.md)
    45‚Üí            {
    46‚Üí              echo "version=$VERSION"
    47‚Üí              echo "changelog<<CHANGELOG_EOF"
    48‚Üí              echo "$CHANGELOG"
    49‚Üí              echo "CHANGELOG_EOF"
    50‚Üí            } >> "$GITHUB_OUTPUT"
    51‚Üí
    52‚Üí      - name: Update release notes with changelog
    53‚Üí        run: |
    54‚Üí          VERSION="${GITHUB_REF_NAME#specstory-cli/}"
    55‚Üí          CHANGELOG=$(awk -v version="$VERSION" 'BEGIN{p=0} /^## /{if ($0 ~ "^## " version){p=1; next} else if (p==1 && /^## /){exit}} p==1{print}' specstory-cli/changelog.md)
    56‚Üí          if [ -n "$CHANGELOG" ]; then
    57‚Üí            gh release edit "$GITHUB_REF_NAME" --notes "$CHANGELOG"
    58‚Üí          fi
    59‚Üí        env:
    60‚Üí          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    61‚Üí
    62‚Üí      - name: Notify Slack (#clients)
    63‚Üí        env:
    64‚Üí            SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL_CLIENTS }}
    65‚Üí            VERSION: ${{ steps.release_details.outputs.version || 'unknown version' }}
    66‚Üí            CHANGELOG: ${{ steps.release_details.outputs.changelog || 'failed collecting release details' }}
    67‚Üí        run: |
    68‚Üí            {
    69‚Üí              printf "\n\nChangelog:\n%s\n" "$CHANGELOG"
    70‚Üí            } > message.txt
    71‚Üí
    72‚Üí            TITLE="*CLI $VERSION released*"
    73‚Üí            jq -n \
    74‚Üí              --rawfile text message.txt \
    75‚Üí              --arg title "$TITLE" \
    76‚Üí              --arg username "SpecStory Release Bot" \
    77‚Üí              --arg icon ":specstory:" \
    78‚Üí              '{
    79‚Üí                username: $username,
    80‚Üí                icon_emoji: $icon,
    81‚Üí                attachments: [
    82‚Üí                  {
    83‚Üí                    color: "#e35a2c",
    84‚Üí                    blocks: [
    85‚Üí                      {
    86‚Üí                        "type": "section",
    87‚Üí                        "text": { "type": "mrkdwn", "text": $title }
    88‚Üí                      },
    89‚Üí                      {
    90‚Üí                        "type": "section",
    91‚Üí                        "text": { "type": "mrkdwn", "text": $text }
    92‚Üí                      }
    93‚Üí                    ]
    94‚Üí                  }
    95‚Üí                ]
    96‚Üí              }' > payload.json
    97‚Üí            curl -X POST -H 'Content-type: application/json' --data @payload.json "$SLACK_WEBHOOK_URL"
    98‚Üí
    99‚Üí  update-homebrew-tap:
   100‚Üí    needs: [goreleaser]
   101‚Üí    runs-on: ubuntu-latest
   102‚Üí    steps:
   103‚Üí      - name: Checkout
   104‚Üí        uses: actions/checkout@v4
   105‚Üí
   106‚Üí      - name: Extract version from tag
   107‚Üí        id: version
   108‚Üí        run: |
   109‚Üí          VERSION="${GITHUB_REF_NAME#specstory-cli/v}"
   110‚Üí          echo "version=$VERSION" >> "$GITHUB_OUTPUT"
   111‚Üí
   112‚Üí      - name: Download release artifacts
   113‚Üí        run: |
   114‚Üí          mkdir -p dist
   115‚Üí          gh release download "$GITHUB_REF_NAME" --pattern "SpecStoryCLI_*.tar.gz" --dir dist
   116‚Üí        env:
   117‚Üí          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
   118‚Üí
   119‚Üí      - name: Compute SHA256 hashes
   120‚Üí        id: hashes
   121‚Üí        run: |
   122‚Üí          echo "darwin_arm64=$(shasum -a 256 dist/SpecStoryCLI_Darwin_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
   123‚Üí          echo "darwin_x86_64=$(shasum -a 256 dist/SpecStoryCLI_Darwin_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
   124‚Üí          echo "linux_arm64=$(shasum -a 256 dist/SpecStoryCLI_Linux_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
   125‚Üí          echo "linux_x86_64=$(shasum -a 256 dist/SpecStoryCLI_Linux_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
   126‚Üí
   127‚Üí      - name: Checkout homebrew-tap
   128‚Üí        uses: actions/checkout@v4
   129‚Üí        with:
   130‚Üí          repository: specstoryai/homebrew-tap
   131‚Üí          token: ${{ secrets.HOMEBREW_TAP_TOKEN }}
   132‚Üí          path: homebrew-tap
   133‚Üí
   134‚Üí      - name: Update formula
   135‚Üí        run: |
   136‚Üí          ./scripts/update-homebrew-formula.sh \
   137‚Üí            homebrew-tap/Formula/specstory.rb \
   138‚Üí            "${{ steps.version.outputs.version }}" \
   139‚Üí            "${{ steps.hashes.outputs.darwin_arm64 }}" \
   140‚Üí            "${{ steps.hashes.outputs.darwin_x86_64 }}" \
   141‚Üí            "${{ steps.hashes.outputs.linux_arm64 }}" \
   142‚Üí            "${{ steps.hashes.outputs.linux_x86_64 }}"
   143‚Üí
   144‚Üí      - name: Commit and push
   145‚Üí        run: |
   146‚Üí          cd homebrew-tap
   147‚Üí          git config user.name "specstory-bot"
   148‚Üí          git config user.email "actions@github.com"
   149‚Üí          git add Formula/specstory.rb
   150‚Üí          git commit -m "Release specstory v${{ steps.version.outputs.version }}"
   151‚Üí          git push
   152‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:40:11.355Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `./scripts/update-homebrew-formula.sh`
```
     1‚Üí#!/usr/bin/env bash
     2‚Üí# Updates the Homebrew formula with new version and SHA256 hashes.
     3‚Üí# Usage: update-homebrew-formula.sh <formula_path> <version> \
     4‚Üí#        <sha_darwin_arm64> <sha_darwin_x86_64> <sha_linux_arm64> <sha_linux_x86_64>
     5‚Üí
     6‚Üíset -euo pipefail
     7‚Üí
     8‚ÜíFORMULA="$1"
     9‚ÜíVERSION="$2"
    10‚ÜíSHA_DARWIN_ARM64="$3"
    11‚ÜíSHA_DARWIN_X86_64="$4"
    12‚ÜíSHA_LINUX_ARM64="$5"
    13‚ÜíSHA_LINUX_X86_64="$6"
    14‚Üí
    15‚Üí# Validate inputs
    16‚Üíif [[ ! -f "$FORMULA" ]]; then
    17‚Üí  echo "Error: Formula file not found: $FORMULA" >&2
    18‚Üí  exit 1
    19‚Üífi
    20‚Üí
    21‚Üífor sha in "$SHA_DARWIN_ARM64" "$SHA_DARWIN_X86_64" "$SHA_LINUX_ARM64" "$SHA_LINUX_X86_64"; do
    22‚Üí  if [[ ! "$sha" =~ ^[a-f0-9]{64}$ ]]; then
    23‚Üí    echo "Error: Invalid SHA256 hash: $sha" >&2
    24‚Üí    exit 1
    25‚Üí  fi
    26‚Üídone
    27‚Üí
    28‚Üíecho "Updating formula: $FORMULA"
    29‚Üíecho "  Version: $VERSION"
    30‚Üí
    31‚Üí# Update version using sed (temp file for macOS compatibility)
    32‚Üísed "s/^  version \".*\"/  version \"${VERSION}\"/" "$FORMULA" > "${FORMULA}.tmp"
    33‚Üímv "${FORMULA}.tmp" "$FORMULA"
    34‚Üí
    35‚Üí# Context-aware SHA256 update using awk
    36‚Üíawk -v darwin_arm64="$SHA_DARWIN_ARM64" \
    37‚Üí    -v darwin_x86="$SHA_DARWIN_X86_64" \
    38‚Üí    -v linux_arm64="$SHA_LINUX_ARM64" \
    39‚Üí    -v linux_x86="$SHA_LINUX_X86_64" '
    40‚Üí{
    41‚Üí  if (/Darwin_arm64/) { arch = "darwin_arm64" }
    42‚Üí  else if (/Darwin_x86_64/) { arch = "darwin_x86" }
    43‚Üí  else if (/Linux_arm64/) { arch = "linux_arm64" }
    44‚Üí  else if (/Linux_x86_64/) { arch = "linux_x86" }
    45‚Üí
    46‚Üí  if (/sha256 "[a-f0-9]{64}"/) {
    47‚Üí    if (arch == "darwin_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_arm64 "\"") }
    48‚Üí    else if (arch == "darwin_x86") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" darwin_x86 "\"") }
    49‚Üí    else if (arch == "linux_arm64") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" linux_arm64 "\"") }
    50‚Üí    else if (arch == "linux_x86") { sub(/sha256 "[a-f0-9]{64}"/, "sha256 \"" linux_x86 "\"") }
    51‚Üí  }
    52‚Üí  print
    53‚Üí}' "$FORMULA" > "${FORMULA}.tmp" && mv "${FORMULA}.tmp" "$FORMULA"
    54‚Üí
    55‚Üíecho "Formula updated successfully"
    56‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:40:14.453Z)**_

<think><details><summary>Thought Process</summary>
Everything looks good. Let me also verify the shell script has correct syntax with bash -n check.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:40:14.780Z)**_

Let me verify the shell script syntax.

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:40:15.505Z)**_

<tool-use data-tool-type="shell" data-tool-name="Bash"><details>
<summary>Tool use: **Bash**</summary>
Verify shell script syntax

`bash -n /Users/sean/source/SpecStory/getspecstory/scripts/update-homebrew-formula.sh && echo "Syntax OK"`
```
Syntax OK
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:40:42.263Z)**_

<think><details><summary>Thought Process</summary>
The implementation is complete. Let me summarize what was done:

1. Created `scripts/update-homebrew-formula.sh` - A bash script that:
   - Takes formula path, version, and 4 SHA256 hashes as arguments
   - Validates inputs (file exists, hashes are valid 64-char hex)
   - Updates the version line using sed
   - Uses context-aware awk to update SHA256 hashes based on architecture in URL

2. Updated `.github/workflows/release.yml`:
   - Added "Update release notes with changelog" step after "Collect release details" and before "Notify Slack"
   - Added new `update-homebrew-tap` job that:
     - Depends on goreleaser job
     - Extracts version from tag
     - Downloads release artifacts
     - Computes SHA256 hashes
     - Checks out homebrew-tap repo
     - Runs the update script
     - Commits and pushes changes

3. Rewrote `specstory-cli/docs/CLI-RELEASE.md` with:
   - Simplified release steps at the top
   - Verification section
   - "What Gets Automated" table
   - Required Secrets table
   - Troubleshooting section
   - Manual fallback instructions

The only prerequisite for this to work is adding the `HOMEBREW_TAP_TOKEN` secret to the repository - a GitHub PAT with write access to `specstoryai/homebrew-tap`.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:40:44.925Z)**_

Implementation complete. Here's a summary of what was created/modified:

**Created:**
- `scripts/update-homebrew-formula.sh` - Bash script to update the Homebrew formula with version and SHA256 hashes

**Modified:**
- `.github/workflows/release.yml`:
  - Added "Update release notes with changelog" step after GoReleaser
  - Added `update-homebrew-tap` job that downloads artifacts, computes hashes, and updates the homebrew-tap repo

- `specstory-cli/docs/CLI-RELEASE.md` - Rewritten with:
  - Simplified release steps at top
  - Automation documentation tables
  - Required secrets table
  - Troubleshooting section

**Required setup:**
Add `HOMEBREW_TAP_TOKEN` secret to the repository - a GitHub PAT with write access to `specstoryai/homebrew-tap`.

---

_**User (2026-01-23T17:42:03.766Z)**_

I added the token.

---

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:42:07.879Z)**_

<think><details><summary>Thought Process</summary>
The user has added the HOMEBREW_TAP_TOKEN secret. The implementation is complete. There's nothing more to do unless they want to test it by creating a release tag.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T17:42:09.659Z)**_

The automation is ready to go. On the next release tag push (`git tag -a specstory-cli/vX.Y.Z -m "Release vX.Y.Z" && git push origin specstory-cli/vX.Y.Z`), the workflow will:

1. Build and release via GoReleaser
2. Update GitHub release notes from changelog
3. Notify Slack
4. Update homebrew-tap with new version and SHA256 hashes

---

_**User (2026-01-23T21:25:31.333Z)**_


1s
Run VERSION="${GITHUB_REF_NAME#specstory-cli/}"
release not found
Error: Process completed with exit code 1.
Run VERSION="${GITHUB_REF_NAME#specstory-cli/}"
release not found
Error: Process completed with exit code 1.

---

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:25:45.550Z)**_

<think><details><summary>Thought Process</summary>
The user is showing errors from the GitHub Actions run. The "release not found" error is happening in the "Update release notes with changelog" step and likely also in the "Download release artifacts" step of the update-homebrew-tap job.

The issue is timing - the release notes update step runs immediately after GoReleaser, but the release might not be fully created yet. Similarly, the homebrew-tap job downloads artifacts right after the goreleaser job completes, but there might be a race condition.

Looking at the workflow:
1. GoReleaser creates the release
2. "Collect release details" runs (has continue-on-error: true)
3. "Update release notes with changelog" tries to edit the release - this is failing
4. Then the update-homebrew-tap job runs and tries to download artifacts

The issue could be:
1. The release wasn't created successfully by GoReleaser
2. There's a timing issue where the release isn't available yet
3. The tag name format doesn't match what `gh release` expects

Let me check - the tag is `specstory-cli/v1.0.0` and we're using `$GITHUB_REF_NAME` which would be `specstory-cli/v1.0.0`. The `gh release edit` and `gh release download` commands use this full tag name.

Wait, looking at GoReleaser - it might be creating the release with a different tag name. Let me check the .goreleaser.yml to see how releases are named.

Actually, the problem might be that GoReleaser is using `GORELEASER_CURRENT_TAG` which is set to `${{ steps.version.outputs.version }}` which is `v1.0.0` (with the `specstory-cli/` prefix stripped). So GoReleaser might be creating a release named `v1.0.0` instead of `specstory-cli/v1.0.0`.

Let me look at this more carefully:


- Line 24 strips the prefix from the tag, outputting just `v1.0.0`
- Line 33 passes this stripped version to GoReleaser as `GORELEASER_CURRENT_TAG`

So GoReleaser is creating a release with tag `v1.0.0`, but the subsequent steps are trying to access it using the full tag `specstory-cli/v1.0.0`. This mismatch is causing the "release not found" errors. I need to check the .goreleaser.yml configuration to confirm how it's naming releases.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:25:45.571Z)**_

The release isn't being found - likely a tag name mismatch. Let me check the GoReleaser config to understand how releases are created.

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:25:45.649Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `./.goreleaser.yml`
```
     1‚Üíversion: 2
     2‚Üí
     3‚Üíproject_name: SpecStoryCLI
     4‚Üí
     5‚Üíbuilds:
     6‚Üí  - env:
     7‚Üí      - CGO_ENABLED=0
     8‚Üí    goos:
     9‚Üí      - linux
    10‚Üí      - darwin
    11‚Üí    goarch:
    12‚Üí      - amd64
    13‚Üí      - arm64
    14‚Üí    binary: specstory
    15‚Üí    main: ./main.go
    16‚Üí    dir: ./specstory-cli
    17‚Üí    ldflags:
    18‚Üí      - -s -w
    19‚Üí      - -X main.version={{.Version}}
    20‚Üí      - -X github.com/specstoryai/getspecstory/specstory-cli/pkg/analytics.apiKey={{.Env.POSTHOG_API_KEY}}
    21‚Üí
    22‚Üíarchives:
    23‚Üí  - id: targz
    24‚Üí    formats: [tar.gz]
    25‚Üí    name_template: >-
    26‚Üí      {{ .ProjectName }}_
    27‚Üí      {{- title .Os }}_
    28‚Üí      {{- if eq .Arch "amd64" }}x86_64
    29‚Üí      {{- else }}{{ .Arch }}{{ end }}
    30‚Üí    files:
    31‚Üí      - none*
    32‚Üí  - id: zip
    33‚Üí    formats: [zip]
    34‚Üí    name_template: >-
    35‚Üí      {{ .ProjectName }}_
    36‚Üí      {{- title .Os }}_
    37‚Üí      {{- if eq .Arch "amd64" }}x86_64
    38‚Üí      {{- else }}{{ .Arch }}{{ end }}
    39‚Üí    files:
    40‚Üí      - none*
    41‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:25:54.599Z)**_

<think><details><summary>Thought Process</summary>
I see - the .goreleaser.yml doesn't have a `release` section, so it uses defaults. By default, GoReleaser creates releases using the git tag. The workflow sets `GORELEASER_CURRENT_TAG: ${{ steps.version.outputs.version }}` which is `v1.0.0` (without the `specstory-cli/` prefix).

So GoReleaser is creating a release with tag `v1.0.0`, but our new steps are trying to access `$GITHUB_REF_NAME` which is `specstory-cli/v1.0.0`.

I need to fix both:
1. The "Update release notes with changelog" step to use `v1.0.0` instead of `specstory-cli/v1.0.0`
2. The "Download release artifacts" step in update-homebrew-tap job to use `v1.0.0`

Looking at the workflow more closely:
- Line 24 creates `version` output as `v1.0.0`
- GoReleaser uses this to create the release

So in the new steps, I should use the version output from the earlier step, not `$GITHUB_REF_NAME`.

For the "Update release notes with changelog" step in the goreleaser job, I can use `${{ steps.version.outputs.version }}` which already exists.

For the "update-homebrew-tap" job, I also need to use the version without the `specstory-cli/` prefix for the `gh release download` command.

Let me fix both.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:25:55.587Z)**_

The issue is that GoReleaser creates the release with tag `v1.0.0` (via `GORELEASER_CURRENT_TAG`), but we're trying to access it with `specstory-cli/v1.0.0`. I need to fix both steps to use the stripped version.

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:26:00.051Z)**_

<tool-use data-tool-type="write" data-tool-name="Edit"><details>
<summary>Tool use: **Edit**</summary>
```
<tool_use_error>File has been modified since read, either by the user or by a linter. Read it again before attempting to write it.</tool_use_error>
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:26:02.686Z)**_

<think><details><summary>Thought Process</summary>
Let me read the file again and then apply the changes.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:26:03.062Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `./.github/workflows/release.yml`
```
     1‚Üíname: Release CLI
     2‚Üí
     3‚Üíon:
     4‚Üí  push:
     5‚Üí    tags:
     6‚Üí      - 'specstory-cli/v*'
     7‚Üí
     8‚Üípermissions:
     9‚Üí  contents: write
    10‚Üí
    11‚Üíjobs:
    12‚Üí  goreleaser:
    13‚Üí    runs-on: ubuntu-latest
    14‚Üí    environment: production
    15‚Üí    steps:
    16‚Üí      - uses: actions/checkout@v4
    17‚Üí        with:
    18‚Üí          fetch-depth: 0
    19‚Üí      - uses: actions/setup-go@v4
    20‚Üí        with:
    21‚Üí          go-version: '1.21'
    22‚Üí      - name: Extract version from tag
    23‚Üí        id: version
    24‚Üí        run: echo "version=${GITHUB_REF_NAME#specstory-cli/}" >> $GITHUB_OUTPUT
    25‚Üí
    26‚Üí      - uses: goreleaser/goreleaser-action@v6
    27‚Üí        with:
    28‚Üí          version: "~> v2"
    29‚Üí          args: release --clean --skip=validate
    30‚Üí        env:
    31‚Üí          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    32‚Üí          POSTHOG_API_KEY: ${{ secrets.POSTHOG_API_KEY }}
    33‚Üí          GORELEASER_CURRENT_TAG: ${{ steps.version.outputs.version }}
    34‚Üí
    35‚Üí      - name: Collect release details
    36‚Üí        id: release_details
    37‚Üí        continue-on-error: true
    38‚Üí        run: |
    39‚Üí            # Extract version from git tag (github.ref_name will be like "specstory-cli/v1.0.0")
    40‚Üí            VERSION="${{ github.ref_name }}"
    41‚Üí            VERSION="${VERSION#specstory-cli/}"  # Strip the subdirectory prefix
    42‚Üí            # Extract changelog for this version from specstory-cli/changelog.md
    43‚Üí            # The changelog format is: ## v0.13.0 2025-10-26
    44‚Üí            CHANGELOG=$(awk -v version="$VERSION" 'BEGIN{p=0} /^## /{if ($0 ~ "^## " version){p=1; next} else if (p==1 && /^## /){exit}} p==1{print}' specstory-cli/changelog.md)
    45‚Üí            {
    46‚Üí              echo "version=$VERSION"
    47‚Üí              echo "changelog<<CHANGELOG_EOF"
    48‚Üí              echo "$CHANGELOG"
    49‚Üí              echo "CHANGELOG_EOF"
    50‚Üí            } >> "$GITHUB_OUTPUT"
    51‚Üí
    52‚Üí      - name: Update release notes with changelog
    53‚Üí        run: |
    54‚Üí          VERSION="${GITHUB_REF_NAME#specstory-cli/}"
    55‚Üí          CHANGELOG=$(awk -v version="$VERSION" 'BEGIN{p=0} /^## /{if ($0 ~ "^## " version){p=1; next} else if (p==1 && /^## /){exit}} p==1{print}' specstory-cli/changelog.md)
    56‚Üí          if [ -n "$CHANGELOG" ]; then
    57‚Üí            gh release edit "$GITHUB_REF_NAME" --notes "$CHANGELOG"
    58‚Üí          fi
    59‚Üí        env:
    60‚Üí          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    61‚Üí
    62‚Üí      - name: Notify Slack (#clients)
    63‚Üí        env:
    64‚Üí            SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL_CLIENTS }}
    65‚Üí            VERSION: ${{ steps.release_details.outputs.version || 'unknown version' }}
    66‚Üí            CHANGELOG: ${{ steps.release_details.outputs.changelog || 'failed collecting release details' }}
    67‚Üí        run: |
    68‚Üí            {
    69‚Üí              printf "\n\nChangelog:\n%s\n" "$CHANGELOG"
    70‚Üí            } > message.txt
    71‚Üí
    72‚Üí            TITLE="*CLI $VERSION released*"
    73‚Üí            jq -n \
    74‚Üí              --rawfile text message.txt \
    75‚Üí              --arg title "$TITLE" \
    76‚Üí              --arg username "SpecStory Release Bot" \
    77‚Üí              --arg icon ":specstory:" \
    78‚Üí              '{
    79‚Üí                username: $username,
    80‚Üí                icon_emoji: $icon,
    81‚Üí                attachments: [
    82‚Üí                  {
    83‚Üí                    color: "#e35a2c",
    84‚Üí                    blocks: [
    85‚Üí                      {
    86‚Üí                        "type": "section",
    87‚Üí                        "text": { "type": "mrkdwn", "text": $title }
    88‚Üí                      },
    89‚Üí                      {
    90‚Üí                        "type": "section",
    91‚Üí                        "text": { "type": "mrkdwn", "text": $text }
    92‚Üí                      }
    93‚Üí                    ]
    94‚Üí                  }
    95‚Üí                ]
    96‚Üí              }' > payload.json
    97‚Üí            curl -X POST -H 'Content-type: application/json' --data @payload.json "$SLACK_WEBHOOK_URL"
    98‚Üí
    99‚Üí  update-homebrew-tap:
   100‚Üí    needs: [goreleaser]
   101‚Üí    runs-on: ubuntu-latest
   102‚Üí    steps:
   103‚Üí      - name: Checkout
   104‚Üí        uses: actions/checkout@v4
   105‚Üí
   106‚Üí      - name: Extract version from tag
   107‚Üí        id: version
   108‚Üí        run: |
   109‚Üí          VERSION="${GITHUB_REF_NAME#specstory-cli/v}"
   110‚Üí          echo "version=$VERSION" >> "$GITHUB_OUTPUT"
   111‚Üí
   112‚Üí      - name: Download release artifacts
   113‚Üí        run: |
   114‚Üí          mkdir -p dist
   115‚Üí          gh release download "$GITHUB_REF_NAME" --pattern "SpecStoryCLI_*.tar.gz" --dir dist
   116‚Üí        env:
   117‚Üí          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
   118‚Üí
   119‚Üí      - name: Compute SHA256 hashes
   120‚Üí        id: hashes
   121‚Üí        run: |
   122‚Üí          echo "darwin_arm64=$(shasum -a 256 dist/SpecStoryCLI_Darwin_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
   123‚Üí          echo "darwin_x86_64=$(shasum -a 256 dist/SpecStoryCLI_Darwin_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
   124‚Üí          echo "linux_arm64=$(shasum -a 256 dist/SpecStoryCLI_Linux_arm64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
   125‚Üí          echo "linux_x86_64=$(shasum -a 256 dist/SpecStoryCLI_Linux_x86_64.tar.gz | cut -d' ' -f1)" >> "$GITHUB_OUTPUT"
   126‚Üí
   127‚Üí      - name: Checkout homebrew-tap
   128‚Üí        uses: actions/checkout@v4
   129‚Üí        with:
   130‚Üí          repository: specstoryai/homebrew-tap
   131‚Üí          token: ${{ secrets.HOMEBREW_TAP_TOKEN }}
   132‚Üí          path: homebrew-tap
   133‚Üí
   134‚Üí      - name: Update formula
   135‚Üí        run: |
   136‚Üí          ./scripts/update-homebrew-formula.sh \
   137‚Üí            homebrew-tap/Formula/specstory.rb \
   138‚Üí            "${{ steps.version.outputs.version }}" \
   139‚Üí            "${{ steps.hashes.outputs.darwin_arm64 }}" \
   140‚Üí            "${{ steps.hashes.outputs.darwin_x86_64 }}" \
   141‚Üí            "${{ steps.hashes.outputs.linux_arm64 }}" \
   142‚Üí            "${{ steps.hashes.outputs.linux_x86_64 }}"
   143‚Üí
   144‚Üí      - name: Commit and push
   145‚Üí        run: |
   146‚Üí          cd homebrew-tap
   147‚Üí          git config user.name "specstory-bot"
   148‚Üí          git config user.email "actions@github.com"
   149‚Üí          git add Formula/specstory.rb
   150‚Üí          git commit -m "Release specstory v${{ steps.version.outputs.version }}"
   151‚Üí          git push
   152‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:26:07.056Z)**_

<think><details><summary>Thought Process</summary>
Now I need to fix both places:

1. Line 52-60: The "Update release notes with changelog" step needs to use the version output (v1.0.0) instead of GITHUB_REF_NAME (specstory-cli/v1.0.0)

2. Line 112-117: The "Download release artifacts" step needs to use the version with `v` prefix (v1.0.0) instead of GITHUB_REF_NAME (specstory-cli/v1.0.0)

Let me fix both.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:26:09.947Z)**_

<tool-use data-tool-type="write" data-tool-name="Edit"><details>
<summary>Tool use: **Edit**</summary>
```
The file /Users/sean/source/SpecStory/getspecstory/.github/workflows/release.yml has been updated successfully.
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:26:24.847Z)**_

<think><details><summary>Thought Process</summary>
Now I need to fix the download step in the update-homebrew-tap job. The version step there extracts just the number (without v), so I need to add `v` back for the release download command.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:26:26.661Z)**_

<tool-use data-tool-type="write" data-tool-name="Edit"><details>
<summary>Tool use: **Edit**</summary>
```
The file /Users/sean/source/SpecStory/getspecstory/.github/workflows/release.yml has been updated successfully.
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:26:39.163Z)**_

<think><details><summary>Thought Process</summary>
Both fixes are done. The release notes step now uses `${{ steps.version.outputs.version }}` (which is `v1.0.0`) and the download step uses `v${{ steps.version.outputs.version }}` (which constructs `v1.0.0` since version outputs just `1.0.0` without the `v`).

Wait, let me double check. In the update-homebrew-tap job, line 109 is:
```
VERSION="${GITHUB_REF_NAME#specstory-cli/v}"
```

This strips `specstory-cli/v` from the tag, so if the tag is `specstory-cli/v1.0.0`, the output is `1.0.0` (no `v`).

So `v${{ steps.version.outputs.version }}` gives `v1.0.0` which is correct.

And in the goreleaser job, line 24:
```
run: echo "version=${GITHUB_REF_NAME#specstory-cli/}" >> $GITHUB_OUTPUT
```

This strips just `specstory-cli/`, so the output is `v1.0.0` (with the `v`).

So using `${{ steps.version.outputs.version }}` in the release notes step gives `v1.0.0` which is correct.

Both fixes should work now.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:26:40.865Z)**_

Fixed both issues. The release tag used by GoReleaser is `v1.0.0` (stripped of the `specstory-cli/` prefix), so:

1. Release notes step now uses `${{ steps.version.outputs.version }}` which is `v1.0.0`
2. Download step now uses `v${{ steps.version.outputs.version }}` which constructs `v1.0.0`

You can re-run the workflow or push a new tag to test.

---

_**User (2026-01-23T21:36:23.505Z)**_

Run actions/checkout@v4
  with:
    repository: specstoryai/homebrew-tap
    path: homebrew-tap
    ssh-strict: true
    ssh-user: git
    persist-credentials: true
    clean: true
    sparse-checkout-cone-mode: true
    fetch-depth: 1
    fetch-tags: false
    show-progress: true
    lfs: false
    submodules: false
    set-safe-directory: true
Error: Input required and not supplied: token

---

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:36:30.583Z)**_

<think><details><summary>Thought Process</summary>
The error shows that the `token` input is required but not supplied. Looking at the workflow, we have:

```yaml
      - name: Checkout homebrew-tap
        uses: actions/checkout@v4
        with:
          repository: specstoryai/homebrew-tap
          token: ${{ secrets.HOMEBREW_TAP_TOKEN }}
          path: homebrew-tap
```

The token is set via `${{ secrets.HOMEBREW_TAP_TOKEN }}`, but the error says "Input required and not supplied: token". This suggests the secret might be empty or not accessible to this job.

Wait - the goreleaser job has `environment: production` but the `update-homebrew-tap` job doesn't. If the secret is scoped to the production environment, it won't be available to the homebrew job.

Let me add `environment: production` to the `update-homebrew-tap` job.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:36:32.158Z)**_

The `HOMEBREW_TAP_TOKEN` secret isn't being passed to the job. The `goreleaser` job uses `environment: production`, but `update-homebrew-tap` doesn't - if the secret is scoped to that environment, it won't be accessible. Let me add the environment.

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:36:32.733Z)**_

<tool-use data-tool-type="read" data-tool-name="Read"><details>
<summary>Tool use: **Read**</summary>
 `./.github/workflows/release.yml`
```
    99‚Üí  update-homebrew-tap:
   100‚Üí    needs: [goreleaser]
   101‚Üí    runs-on: ubuntu-latest
   102‚Üí    steps:
   103‚Üí      - name: Checkout
   104‚Üí        uses: actions/checkout@v4
   105‚Üí
   106‚Üí      - name: Extract version from tag
   107‚Üí        id: version
   108‚Üí        run: |
   109‚Üí          VERSION="${GITHUB_REF_NAME#specstory-cli/v}"
   110‚Üí          echo "version=$VERSION" >> "$GITHUB_OUTPUT"
   111‚Üí
   112‚Üí      - name: Download release artifacts
   113‚Üí        run: |
   114‚Üí          mkdir -p dist
   115‚Üí          gh release download "v${{ steps.version.outputs.version }}" --pattern "SpecStoryCLI_*.tar.gz" --dir dist
   116‚Üí        env:
   117‚Üí          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
   118‚Üí
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:36:35.989Z)**_

<think><details><summary>Thought Process</summary>
I need to add `environment: production` to the `update-homebrew-tap` job so it can access the environment secrets.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:36:37.215Z)**_

<tool-use data-tool-type="write" data-tool-name="Edit"><details>
<summary>Tool use: **Edit**</summary>
```
The file /Users/sean/source/SpecStory/getspecstory/.github/workflows/release.yml has been updated successfully.
```
</details></tool-use>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:36:48.566Z)**_

<think><details><summary>Thought Process</summary>
Added `environment: production` to the `update-homebrew-tap` job so it can access the `HOMEBREW_TAP_TOKEN` secret.
</details></think>

_**Agent (claude-opus-4-5-20251101 2026-01-23T21:36:48.875Z)**_

Added `environment: production` to the `update-homebrew-tap` job so it can access the secret.
